

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Processes &mdash; Nextflow-ZH-documentation 0.0.1 文档</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/translations.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="Channels" href="channel.html" />
    <link rel="prev" title="Nextflow 脚本语言" href="script.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Nextflow-ZH-documentation
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getstarted.html">开始</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic.html">基本理念</a></li>
<li class="toctree-l1"><a class="reference internal" href="script.html">Nextflow 脚本语言</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Processes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#process-script">脚本</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">脚本语言</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">条件脚本</a></li>
<li class="toctree-l3"><a class="reference internal" href="#process-template">模板</a></li>
<li class="toctree-l3"><a class="reference internal" href="#shell">Shell</a></li>
<li class="toctree-l3"><a class="reference internal" href="#process-native">本地执行</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#inputs">Inputs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id6">输入通用值</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id7">输入文件</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id8">多个输入文件</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id9">动态输入文件名</a></li>
<li class="toctree-l3"><a class="reference internal" href="#stdin">输入’stdin’类型</a></li>
<li class="toctree-l3"><a class="reference internal" href="#env">输入’env’类型</a></li>
<li class="toctree-l3"><a class="reference internal" href="#set">输入’set’类型</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id10">重复输入</a></li>
<li class="toctree-l3"><a class="reference internal" href="#channels">了解多个输入channels的工作原理</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id11">输出</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#output-values">Output values</a></li>
<li class="toctree-l3"><a class="reference internal" href="#output-files">Output files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#multiple-output-files">Multiple output files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#process-dynoutname">动态输出文件名</a></li>
<li class="toctree-l3"><a class="reference internal" href="#stdout">输出 ‘stdout’ 特殊文件</a></li>
<li class="toctree-l3"><a class="reference internal" href="#process-set">输出’set’值</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id14">可选输出</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#when">When</a></li>
<li class="toctree-l2"><a class="reference internal" href="#directives">Directives</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#afterscript">afterScript</a></li>
<li class="toctree-l3"><a class="reference internal" href="#beforescript">beforeScript</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cache">cache</a></li>
<li class="toctree-l3"><a class="reference internal" href="#conda">conda</a></li>
<li class="toctree-l3"><a class="reference internal" href="#container">container</a></li>
<li class="toctree-l3"><a class="reference internal" href="#containeroptions">containerOptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cpus">cpus</a></li>
<li class="toctree-l3"><a class="reference internal" href="#clusteroptions">clusterOptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#disk">disk</a></li>
<li class="toctree-l3"><a class="reference internal" href="#echo">echo</a></li>
<li class="toctree-l3"><a class="reference internal" href="#errorstrategy">errorStrategy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#executor">executor</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ext">ext</a></li>
<li class="toctree-l3"><a class="reference internal" href="#maxerrors">maxErrors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#maxforks">maxForks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#maxretries">maxRetries</a></li>
<li class="toctree-l3"><a class="reference internal" href="#memory">memory</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module">module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#penv">penv</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pod">pod</a></li>
<li class="toctree-l3"><a class="reference internal" href="#publishdir">publishDir</a></li>
<li class="toctree-l3"><a class="reference internal" href="#queue">queue</a></li>
<li class="toctree-l3"><a class="reference internal" href="#label">label</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scratch">scratch</a></li>
<li class="toctree-l3"><a class="reference internal" href="#storedir">storeDir</a></li>
<li class="toctree-l3"><a class="reference internal" href="#stageinmode">stageInMode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#stageoutmode">stageOutMode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tag">tag</a></li>
<li class="toctree-l3"><a class="reference internal" href="#time">time</a></li>
<li class="toctree-l3"><a class="reference internal" href="#validexitstatus">validExitStatus</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dynamic-directives">Dynamic directives</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dynamic-computing-resources">Dynamic computing resources</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="channel.html">Channels</a></li>
<li class="toctree-l1"><a class="reference internal" href="operator.html">Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="executor.html">Executors</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html">配置</a></li>
<li class="toctree-l1"><a class="reference internal" href="awscloud.html">Amazon Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="amazons3.html">Amazon S3 storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="google.html">Google Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="conda.html">Conda environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker.html">Docker containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="singularity.html">Singularity containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="ignite.html">Apache Ignite</a></li>
<li class="toctree-l1"><a class="reference internal" href="kubernetes.html">Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="tracing.html">Tracing &amp; visualisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="sharing.html">Pipeline sharing</a></li>
<li class="toctree-l1"><a class="reference internal" href="metadata.html">Workflow introspection</a></li>
<li class="toctree-l1"><a class="reference internal" href="mail.html">Mail &amp; Notifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="example.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="metrics.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Nextflow-ZH-documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Processes</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/doc/process.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="processes">
<span id="process-page"></span><h1>Processes<a class="headerlink" href="#processes" title="永久链接至标题">¶</a></h1>
<p>在Nextflow中，<code class="docutils literal notranslate"><span class="pre">process</span></code> 是执行用户脚本的基本处理进程。</p>
<p>process定义以关键字 <code class="docutils literal notranslate"><span class="pre">process</span></code> 开始，后跟process名称，最后由大括号分隔的process代码块。 <code class="docutils literal notranslate"><span class="pre">process</span></code> 正文必须包含表示命令的字符串，或者更一般地说，包含由其执行的脚本。 一个基本 <code class="docutils literal notranslate"><span class="pre">process</span></code> 如下例所示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">sayHello</span> <span class="p">{</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    echo &#39;Hello world!&#39; &gt; file</span>
<span class="sd">    &quot;&quot;&quot;</span>

<span class="p">}</span>
</pre></div>
</div>
<p>一个process可以分别包含五个定义块, 分别是：指令(directives)，输入(inputs)，输出(outputs)，when子句和最后的process脚本。 语法定义如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="o">&lt;</span> <span class="n">name</span> <span class="o">&gt;</span> <span class="p">{</span>

   <span class="p">[</span> <span class="n">directives</span> <span class="p">]</span>

   <span class="nb">input</span><span class="p">:</span>
    <span class="o">&lt;</span> <span class="n">process</span> <span class="n">inputs</span> <span class="o">&gt;</span>

   <span class="n">output</span><span class="p">:</span>
    <span class="o">&lt;</span> <span class="n">process</span> <span class="n">outputs</span> <span class="o">&gt;</span>

   <span class="n">when</span><span class="p">:</span>
    <span class="o">&lt;</span> <span class="n">condition</span> <span class="o">&gt;</span>

   <span class="p">[</span><span class="n">script</span><span class="o">|</span><span class="n">shell</span><span class="o">|</span><span class="n">exec</span><span class="p">]:</span>
   <span class="o">&lt;</span> <span class="n">user</span> <span class="n">script</span> <span class="n">to</span> <span class="n">be</span> <span class="n">executed</span> <span class="o">&gt;</span>

<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="process-script">
<span id="id1"></span><h2>脚本<a class="headerlink" href="#process-script" title="永久链接至标题">¶</a></h2>
<p>脚本块是一个字符串语句，用于定义process执行其执行任务的命令。</p>
<p>process包含一个且只有一个脚本块，当process包含输入和输出声明时，它必须是最后一个语句。</p>
<p>输入的字符串在主机系统中作为`Bash &lt;<a class="reference external" href="http://en.wikipedia.org/wiki/Bash_(Unix_shell)">http://en.wikipedia.org/wiki/Bash_(Unix_shell)</a>&gt;`_ 脚本执行。 它可以是您通常在终端shell或常见的Bash脚本中使用的任何命令，脚本或它们的组合。</p>
<p>脚本语句中使用的命令的唯一限制是在目标执行系统中那些实用性程序。</p>
<p>脚本块可以是简单的字符串或多行字符串。 后者简化了由跨越多行的多个命令组成的非平凡脚本的编写。 例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">doMoreThings</span> <span class="p">{</span>

  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  blastp -db $db -query query.fa -outfmt 6 &gt; blast_result</span>
<span class="sd">  cat blast_result | head -n 10 | cut -f 2 &gt; top_hits</span>
<span class="sd">  blastdbcmd -db $db -entry_batch top_hits &gt; sequences</span>
<span class="sd">  &quot;&quot;&quot;</span>

<span class="p">}</span>
</pre></div>
</div>
<p>如脚本教程部分所述，可以使用单引号或双引号定义字符串，多行字符串由三个单引号或三个双引号字符定义。</p>
<p>它们之间存在微妙但重要的区别。 就像在Bash中一样，双引号 <code class="docutils literal notranslate"><span class="pre">&quot;</span></code> 的字符串支持变量替换，而单引号 <code class="docutils literal notranslate"><span class="pre">'</span></code> 的字符串则不行。</p>
<p>在上面的代码片段中， <code class="docutils literal notranslate"><span class="pre">$db</span></code> 变量被流程脚本中某处定义的实际值替换。</p>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last">由于Nextflow对字符串中的变量替换使用相同的Bash语法，因此您需要仔细管理它们，具体取决于您是否要在Nextflow上下文中评估变量 - 或者 - 在Bash环境执行中。</p>
</div>
<p>当您需要在脚本中访问系统环境变量时，您有两个选择。 第一种选择就像使用单引号字符串定义脚本块一样简单。 例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">printPath</span> <span class="p">{</span>

   <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">   echo The path is: $PATH</span>
<span class="sd">   &#39;&#39;&#39;</span>

<span class="p">}</span>
</pre></div>
</div>
<p>此解决方案的缺点是您将无法在脚本块中访问流程脚本上下文中定义的变量。</p>
<p>要解决此问题，请使用双引号字符串定义脚本，并通过在前面添加反斜杠( <code class="docutils literal notranslate"><span class="pre">\</span></code> )字符来转义(<cite>escape</cite> )系统环境变量，如以下示例所示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">doOtherThings</span> <span class="p">{</span>

  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  blastp -db \$DB -query query.fa -outfmt 6 &gt; blast_result</span>
<span class="sd">  cat blast_result | head -n $MAX | cut -f 2 &gt; top_hits</span>
<span class="sd">  blastdbcmd -db \$DB -entry_batch top_hits &gt; sequences</span>
<span class="sd">  &quot;&quot;&quot;</span>

<span class="p">}</span>
</pre></div>
</div>
<p>在此示例中，必须在流程脚本之前的某处定义 <code class="docutils literal notranslate"><span class="pre">$MAX</span></code> 变量。 在执行脚本之前，Nextflow会将其替换为实际值。 相反，<code class="docutils literal notranslate"><span class="pre">$DB</span></code> 变量必须存在于脚本执行环境中，Bash解释器将用实际值替换它。</p>
<div class="admonition tip">
<p class="first admonition-title">小技巧</p>
<p class="last">或者，您可以使用 <a class="reference internal" href="#process-shell"><span class="std std-ref">Shell</span></a> 块定义，该定义允许脚本包含Bash和Nextflow变量，而不必转义第一个。</p>
</div>
<div class="section" id="id2">
<h3>脚本语言<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h3>
<p>默认情况下，Nextflow Process将流程脚本解释为Bash脚本，但您不必受限于此。</p>
<p>您可以使用自己喜欢的脚本语言（例如Perl，Python，Ruby，R等），甚至可以将它们混合在同一个流程中。</p>
<p>流程可以由执行非常不同的任务的进程组成。 使用Nextflow，您可以选择更适合指定进程执行的任务的脚本语言。 例如，对于某些进程，R可能比Perl更有用，在其他情况下，您可能需要使用Python，因为它可以更好地访问一个库或一个API等。</p>
<p>要使用Bash以外的脚本，只需使用相应的 <a class="reference external" href="http://en.wikipedia.org/wiki/Shebang_(Unix)">shebang</a> 声明启动您的流程脚本。 例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">perlStuff</span> <span class="p">{</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    #!/usr/bin/perl</span>

<span class="sd">    print &#39;Hi there!&#39; . &#39;\n&#39;;</span>
<span class="sd">    &quot;&quot;&quot;</span>

<span class="p">}</span>

<span class="n">process</span> <span class="n">pyStuff</span> <span class="p">{</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    #!/usr/bin/python</span>

<span class="sd">    x = &#39;Hello&#39;</span>
<span class="sd">    y = &#39;world!&#39;</span>
<span class="sd">    print &quot;%s - %s&quot; % (x,y)</span>
<span class="sd">    &quot;&quot;&quot;</span>

<span class="p">}</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">小技巧</p>
<p class="last">由于解释器二进制文件的实际位置可以跨平台更改，为了使脚本更具可移植性，最好使用 <code class="docutils literal notranslate"><span class="pre">env</span></code> shell命令后跟解释器的名称，而不是它的绝对路径。 因此，例如，Perl脚本的shebang声明看起来像： <code class="docutils literal notranslate"><span class="pre">#!/usr/bin/env</span> <span class="pre">perl</span></code> 而不是上面流程片段中的那个。</p>
</div>
</div>
<div class="section" id="id3">
<h3>条件脚本<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h3>
<p>复杂的process脚本可能需要评估输入参数的条件或使用传统的数据流控制语句（即 <code class="docutils literal notranslate"><span class="pre">if</span></code>, <code class="docutils literal notranslate"><span class="pre">switch</span></code>,等）以执行特定的脚本命令，具体取决于当前的输入配置.</p>
<p><code class="docutils literal notranslate"><span class="pre">process</span></code> 脚本可以通过在脚本块前面加上关键字 <code class="docutils literal notranslate"><span class="pre">mode</span></code> 前缀来包含条件语句. 通过这样做，解释器将所有以下语句评估为必须返回要执行的脚本字符串的代码块.
它比使用解释更容易, 例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">seq_to_align</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;tcoffee&#39;</span>

<span class="n">process</span> <span class="n">align</span> <span class="p">{</span>
    <span class="nb">input</span><span class="p">:</span>
    <span class="n">file</span> <span class="n">seq_to_aln</span> <span class="kn">from</span> <span class="nn">sequences</span>

    <span class="n">script</span><span class="p">:</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;tcoffee&#39;</span> <span class="p">)</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        t_coffee -in $seq_to_aln &gt; out_file</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;mafft&#39;</span> <span class="p">)</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        mafft --anysymbol --parttree --quiet $seq_to_aln &gt; out_file</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;clustalo&#39;</span> <span class="p">)</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        clustalo -i $seq_to_aln -o out_file</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">else</span>
        <span class="n">error</span> <span class="s2">&quot;Invalid alignment mode: $</span><span class="si">{mode}</span><span class="s2">&quot;</span>

<span class="p">}</span>
</pre></div>
</div>
<p>在上面的示例中，process将根据 <code class="docutils literal notranslate"><span class="pre">mode</span></code> 参数的值执行脚本片段。 默认情况下，它将执行  <code class="docutils literal notranslate"><span class="pre">tcoffee</span></code>  命令，将 <code class="docutils literal notranslate"><span class="pre">mode</span></code> 变量更改为 <code class="docutils literal notranslate"><span class="pre">mafft</span></code> 或 <code class="docutils literal notranslate"><span class="pre">clustalo</span></code> 值，其他分支将被执行。</p>
</div>
<div class="section" id="process-template">
<span id="id4"></span><h3>模板<a class="headerlink" href="#process-template" title="永久链接至标题">¶</a></h3>
<p>process脚本可以通过使用 <em>template</em> 文件进行外部化，模板文件可以在不同的process中重复使用，并由整个流程执行独立测试。</p>
<p>模板只是一个shell脚本文件，Nextflow可以使用 <code class="docutils literal notranslate"><span class="pre">template</span></code> 函数执行，如下所示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">template_example</span> <span class="p">{</span>

    <span class="nb">input</span><span class="p">:</span>
    <span class="n">val</span> <span class="n">STR</span> <span class="kn">from</span> <span class="s1">&#39;this&#39;</span><span class="p">,</span> <span class="s1">&#39;that&#39;</span>

    <span class="n">script</span><span class="p">:</span>
    <span class="n">template</span> <span class="s1">&#39;my_script.sh&#39;</span>

<span class="p">}</span>
</pre></div>
</div>
<p>Nextflow在 <code class="docutils literal notranslate"><span class="pre">templates</span></code> 目录中查找 <code class="docutils literal notranslate"><span class="pre">my_script.sh</span></code> 模板文件，该模板必须存在于Nextflow脚本文件所在的同一文件夹中（可以使用绝对模板路径提供任何其他位置）。</p>
<p>模板脚本可以包含可由底层系统执行的任何代码段。 例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/bash
echo &quot;process started at `date`&quot;
echo $STR
:
echo &quot;process completed&quot;
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">小技巧</p>
<p class="last">请注意，当脚本作为Nextflow模板运行时，美元字符（<code class="docutils literal notranslate"><span class="pre">$</span></code>）将被解释为Nextflow变量占位符，而当单独运行时，它将被计算为Bash变量。 这对于自主测试脚本非常有用，即独立于Nextflow执行。 您只需为脚本中存在的每个Nextflow变量提供Bash环境变量。 例如，可以执行以上脚本在shell终端中输入以下命令：<code class="docutils literal notranslate"><span class="pre">STR='foo'</span> <span class="pre">bash</span> <span class="pre">templates/my_script.sh</span></code></p>
</div>
</div>
<div class="section" id="shell">
<span id="process-shell"></span><h3>Shell<a class="headerlink" href="#shell" title="永久链接至标题">¶</a></h3>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p>这是一个孵化功能。 它可能会在将来的Nextflow版本中发生变化。</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">shell</span></code> 块是一个字符串语句，它定义process执行的shell命令以执行其任务。 它是 <a class="reference internal" href="#process-script"><span class="std std-ref">脚本</span></a> 定义的替代品，具有重要的区别，它使用感叹号``!`` 字符作为Nextflow变量的变量占位符，代替通常的美元字符。</p>
</div>
<p>通过这种方式，可以在同一段代码中同时使用Nextflow和Bash变量，而不必逃避后者并使流程脚本更易读和易于维护。 例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">myTask</span> <span class="p">{</span>

    <span class="nb">input</span><span class="p">:</span>
    <span class="n">val</span> <span class="nb">str</span> <span class="kn">from</span> <span class="s1">&#39;Hello&#39;</span><span class="p">,</span> <span class="s1">&#39;Hola&#39;</span><span class="p">,</span> <span class="s1">&#39;Bonjour&#39;</span>

    <span class="n">shell</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    echo User $USER says !{str}</span>
<span class="sd">    &#39;&#39;&#39;</span>

<span class="p">}</span>
</pre></div>
</div>
<p>在上面的简单示例中，<code class="docutils literal notranslate"><span class="pre">$USER</span></code> 变量由Bash解释器管理，而``!{str}``作为由Nextflow管理的process输入变量处理。</p>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">-Shell脚本定义需要使用单引号 <code class="docutils literal notranslate"><span class="pre">'</span></code> 分隔字符串。 当使用双引号 <code class="docutils literal notranslate"><span class="pre">&quot;</span></code> 分隔字符串时，美元变量像往常一样被解释为Nextflow变量。请参阅 <a class="reference internal" href="script.html#string-interpolation"><span class="std std-ref">字符串插值</span></a> 。
-感叹号前缀变量总是需要用大括号括起来，即 <code class="docutils literal notranslate"><span class="pre">!{str}</span></code> 是有效变量，而 <code class="docutils literal notranslate"><span class="pre">!str</span></code> 被忽略。
-Shell脚本支持使用 <a class="reference internal" href="#process-template"><span class="std std-ref">模板</span></a> 文件机制。 相同的规则适用于脚本模板中定义的变量。</p>
</div>
</div>
<div class="section" id="process-native">
<span id="id5"></span><h3>本地执行<a class="headerlink" href="#process-native" title="永久链接至标题">¶</a></h3>
<p>Nextflow process可以执行除系统脚本之外的本机代码，如前面段落所示。</p>
<p>这意味着您可以通过提供一个或多个语言语句来定义它，而不是将process命令指定为字符串脚本，而不是像在流程脚本的其余部分中那样。 只需使用 <code class="docutils literal notranslate"><span class="pre">exec:</span></code> 关键字启动脚本定义块，例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">Channel</span><span class="o">.</span><span class="n">from</span><span class="p">(</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">)</span>

<span class="n">process</span> <span class="n">simpleSum</span> <span class="p">{</span>
    <span class="nb">input</span><span class="p">:</span>
    <span class="n">val</span> <span class="n">x</span>

    <span class="n">exec</span><span class="p">:</span>
    <span class="n">println</span> <span class="s2">&quot;Hello Mr. $x&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Will display:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Hello</span> <span class="n">Mr</span><span class="o">.</span> <span class="n">b</span>
<span class="n">Hello</span> <span class="n">Mr</span><span class="o">.</span> <span class="n">a</span>
<span class="n">Hello</span> <span class="n">Mr</span><span class="o">.</span> <span class="n">c</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="inputs">
<span id="process-input"></span><h2>Inputs<a class="headerlink" href="#inputs" title="永久链接至标题">¶</a></h2>
<p>Nextflow process彼此隔离，但可以在它们之间通过channels发送值进行通信。</p>
<p><code class="docutils literal notranslate"><span class="pre">input</span></code> 块定义了process期望从哪些channels接收输入数据。 您一次只能定义一个输入块，并且必须包含一个或多个输入声明。</p>
<p>input块遵循以下语法:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">input</span><span class="p">:</span>
  <span class="o">&lt;</span><span class="nb">input</span> <span class="n">qualifier</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="nb">input</span> <span class="n">name</span><span class="o">&gt;</span> <span class="p">[</span><span class="kn">from</span> <span class="o">&lt;</span><span class="n">source</span> <span class="n">channel</span><span class="o">&gt;</span><span class="p">]</span> <span class="p">[</span><span class="n">attributes</span><span class="p">]</span>
</pre></div>
</div>
<p>input定义以输入限定符(input <cite>qualifier</cite>)和输入名称(input <cite>name</cite>)开头，后跟关键字 <code class="docutils literal notranslate"><span class="pre">from</span></code> 和接收输入的实际通道。 最后，可以指定一些输入可选属性。</p>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">当输入名称与channel名称相同时，可以省略声明的 <code class="docutils literal notranslate"><span class="pre">from</span></code> 部分。</p>
</div>
<p>输入限定符声明要接收的数据类型。 Nextflow使用此信息来应用与每个限定符关联的语义规则，并根据目标执行平台（grid, cloud, etc）正确处理它。</p>
<p>可用的限定符是下表中列出的限定符：</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Qualifier</th>
<th class="head">Semantic</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>val</td>
<td>Lets you access the received input value by its name in the process script.</td>
</tr>
<tr class="row-odd"><td>env</td>
<td>Lets you use the received value to set an environment variable named
as the specified input name.</td>
</tr>
<tr class="row-even"><td>file</td>
<td>Lets you handle the received value as a file, staging it properly in the execution context.</td>
</tr>
<tr class="row-odd"><td>stdin</td>
<td>Lets you forward the received value to the process <cite>stdin</cite> special file.</td>
</tr>
<tr class="row-even"><td>set</td>
<td>Lets you handle a group of input values having one of the above qualifiers.</td>
</tr>
<tr class="row-odd"><td>each</td>
<td>Lets you execute the process for each entry in the input collection.</td>
</tr>
</tbody>
</table>
<div class="section" id="id6">
<h3>输入通用值<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">val</span></code> 限定符允许您接收任何类型的数据作为输入。 可以使用指定的输入名称在进程脚本中访问它，如以下示例所示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">num</span> <span class="o">=</span> <span class="n">Channel</span><span class="o">.</span><span class="n">from</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="p">)</span>

<span class="n">process</span> <span class="n">basicExample</span> <span class="p">{</span>
  <span class="nb">input</span><span class="p">:</span>
  <span class="n">val</span> <span class="n">x</span> <span class="kn">from</span> <span class="nn">num</span>

  <span class="s2">&quot;echo process job $x&quot;</span>

<span class="p">}</span>
</pre></div>
</div>
<p>在上面的例子中，每次从 channel <code class="docutils literal notranslate"><span class="pre">num</span></code> 接收一个值并用于处理脚本时，该过程执行三次。 因此，它产生类似于下图所示的输出:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">job</span> <span class="mi">3</span>
<span class="n">process</span> <span class="n">job</span> <span class="mi">1</span>
<span class="n">process</span> <span class="n">job</span> <span class="mi">2</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">channel保证项目(items)的发送顺序与被发送顺序相同 - 但是 - 由于该过程以并行方式执行，因此无法保证按照接收顺序处理它们。 实际上，在上面的例子中，值 <code class="docutils literal notranslate"><span class="pre">3</span></code> 在其他之前被处理。</p>
</div>
<p>当 <code class="docutils literal notranslate"><span class="pre">val</span></code> 与接收数据的channel同名时，可以省略 <code class="docutils literal notranslate"><span class="pre">from</span></code> 部分。 因此，上面的例子可以写成如下所示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">num</span> <span class="o">=</span> <span class="n">Channel</span><span class="o">.</span><span class="n">from</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="p">)</span>

<span class="n">process</span> <span class="n">basicExample</span> <span class="p">{</span>
  <span class="nb">input</span><span class="p">:</span>
  <span class="n">val</span> <span class="n">num</span>

  <span class="s2">&quot;echo process job $num&quot;</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h3>输入文件<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">file</span></code> 限定符允许在process执行上下文中处理文件。 这意味着Nextflow将在process执行目录中将其暂存，并且可以使用输入声明中指定的名称在脚本中进行访问。 例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">proteins</span> <span class="o">=</span> <span class="n">Channel</span><span class="o">.</span><span class="n">fromPath</span><span class="p">(</span> <span class="s1">&#39;/some/path/*.fa&#39;</span> <span class="p">)</span>

<span class="n">process</span> <span class="n">blastThemAll</span> <span class="p">{</span>
  <span class="nb">input</span><span class="p">:</span>
  <span class="n">file</span> <span class="n">query_file</span> <span class="kn">from</span> <span class="nn">proteins</span>

  <span class="s2">&quot;blastp -query $</span><span class="si">{query_file}</span><span class="s2"> -db nr&quot;</span>

<span class="p">}</span>
</pre></div>
</div>
<p>在上面的例子中，所有以后缀 <code class="docutils literal notranslate"><span class="pre">.fa</span></code> 结尾的文件都是通过channel <code class="docutils literal notranslate"><span class="pre">proteins</span></code> 发送的。 然后，process将接收这些文件，这些文件将对每个文件执行BLAST比对。</p>
<p>当文件输入名称与channel名称相同时，可以省略输入声明的 <code class="docutils literal notranslate"><span class="pre">from</span></code> 部分。 因此，上面的例子可以写成如下所示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">proteins</span> <span class="o">=</span> <span class="n">Channel</span><span class="o">.</span><span class="n">fromPath</span><span class="p">(</span> <span class="s1">&#39;/some/path/*.fa&#39;</span> <span class="p">)</span>

<span class="n">process</span> <span class="n">blastThemAll</span> <span class="p">{</span>
  <span class="nb">input</span><span class="p">:</span>
  <span class="n">file</span> <span class="n">proteins</span>

  <span class="s2">&quot;blastp -query $proteins -db nr&quot;</span>

<span class="p">}</span>
</pre></div>
</div>
<p>值得注意的是，在上面的示例中，未触及文件系统中文件的名称，即使不知道其名称也可以访问该文件，因为您可以使用指定名称的变量在process脚本中引用它,在输入文件参数中声明。</p>
<p>在某些情况下，您的任务需要使用名称已修复的文件，而不必随实际提供的文件一起更改。 在这种情况下，您可以通过在输入文件参数声明中指定 <code class="docutils literal notranslate"><span class="pre">name</span></code> 属性来指定其名称，如以下示例所示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">input</span><span class="p">:</span>
    <span class="n">file</span> <span class="n">query_file</span> <span class="n">name</span> <span class="s1">&#39;query.fa&#39;</span> <span class="kn">from</span> <span class="nn">proteins</span>
</pre></div>
</div>
<p>或者使用更短的语法:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">input</span><span class="p">:</span>
    <span class="n">file</span> <span class="s1">&#39;query.fa&#39;</span> <span class="kn">from</span> <span class="nn">proteins</span>
</pre></div>
</div>
<p>使用它，可以重写前面的示例，如下所示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">proteins</span> <span class="o">=</span> <span class="n">Channel</span><span class="o">.</span><span class="n">fromPath</span><span class="p">(</span> <span class="s1">&#39;/some/path/*.fa&#39;</span> <span class="p">)</span>

<span class="n">process</span> <span class="n">blastThemAll</span> <span class="p">{</span>
  <span class="nb">input</span><span class="p">:</span>
  <span class="n">file</span> <span class="s1">&#39;query.fa&#39;</span> <span class="kn">from</span> <span class="nn">proteins</span>

  <span class="s2">&quot;blastp -query query.fa -db nr&quot;</span>

<span class="p">}</span>
</pre></div>
</div>
<p>在此示例中发生的情况是，process接收的每个文件在不同的执行上下文（即执行作业的文件夹）中使用名称 <code class="docutils literal notranslate"><span class="pre">query.fa</span></code> 进行暂存，并启动独立的process执行。</p>
<div class="admonition tip">
<p class="first admonition-title">小技巧</p>
<p class="last">这允许您在不必担心文件名更改的情况下执行各种时间的process命令。 换句话说，Nextflow可帮助您编写由执行环境自包含和解耦的流程任务。 这也是您应该尽可能避免使用引用流程processes中的文件的绝对路径或相对路径的原因。</p>
</div>
</div>
<div class="section" id="id8">
<h3>多个输入文件<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h3>
<p>process可以将声明为值集合的channel声明为输入文件，而不是简单值。</p>
<p>在这种情况下，输入文件参数定义的脚本变量将包含文件列表。 您可以如前所示使用它，引用列表中的所有文件，或使用通常的方括号表示法访问特定条目。</p>
<p>当在输入参数中定义目标文件名并且process接收到文件集合时，文件名将附加一个数字后缀，表示其在列表中的序号位置。 例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fasta</span> <span class="o">=</span> <span class="n">Channel</span><span class="o">.</span><span class="n">fromPath</span><span class="p">(</span> <span class="s2">&quot;/some/path/*.fa&quot;</span> <span class="p">)</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">size</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span>

<span class="n">process</span> <span class="n">blastThemAll</span> <span class="p">{</span>
    <span class="nb">input</span><span class="p">:</span>
    <span class="n">file</span> <span class="s1">&#39;seq&#39;</span> <span class="kn">from</span> <span class="nn">fasta</span>

    <span class="s2">&quot;echo seq*&quot;</span>

<span class="p">}</span>
</pre></div>
</div>
<p>Will output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">seq1</span> <span class="n">seq2</span> <span class="n">seq3</span>
<span class="n">seq1</span> <span class="n">seq2</span> <span class="n">seq3</span>
<span class="o">...</span>
</pre></div>
</div>
<p>目标输入文件名可以包含 <code class="docutils literal notranslate"><span class="pre">*</span></code> 和 <code class="docutils literal notranslate"><span class="pre">?</span></code> 通配符，可用于控制暂存文件的名称。 下表显示了如何根据接收的输入集合的基数替换通配符。</p>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="10%" />
<col width="81%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Cardinality</th>
<th class="head">Name pattern</th>
<th class="head">Staged file names</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>any</td>
<td><code class="docutils literal notranslate"><span class="pre">*</span></code></td>
<td>named as the source file</td>
</tr>
<tr class="row-odd"><td>1</td>
<td><code class="docutils literal notranslate"><span class="pre">file*.ext</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">file.ext</span></code></td>
</tr>
<tr class="row-even"><td>1</td>
<td><code class="docutils literal notranslate"><span class="pre">file?.ext</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">file1.ext</span></code></td>
</tr>
<tr class="row-odd"><td>1</td>
<td><code class="docutils literal notranslate"><span class="pre">file??.ext</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">file01.ext</span></code></td>
</tr>
<tr class="row-even"><td>many</td>
<td><code class="docutils literal notranslate"><span class="pre">file*.ext</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">file1.ext</span></code>, <code class="docutils literal notranslate"><span class="pre">file2.ext</span></code>, <code class="docutils literal notranslate"><span class="pre">file3.ext</span></code>, ..</td>
</tr>
<tr class="row-odd"><td>many</td>
<td><code class="docutils literal notranslate"><span class="pre">file?.ext</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">file1.ext</span></code>, <code class="docutils literal notranslate"><span class="pre">file2.ext</span></code>, <code class="docutils literal notranslate"><span class="pre">file3.ext</span></code>, ..</td>
</tr>
<tr class="row-even"><td>many</td>
<td><code class="docutils literal notranslate"><span class="pre">file??.ext</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">file01.ext</span></code>, <code class="docutils literal notranslate"><span class="pre">file02.ext</span></code>, <code class="docutils literal notranslate"><span class="pre">file03.ext</span></code>, ..</td>
</tr>
<tr class="row-odd"><td>many</td>
<td><code class="docutils literal notranslate"><span class="pre">dir/*</span></code></td>
<td>named as the source file, created in <code class="docutils literal notranslate"><span class="pre">dir</span></code> subdirectory</td>
</tr>
<tr class="row-even"><td>many</td>
<td><code class="docutils literal notranslate"><span class="pre">dir??/*</span></code></td>
<td>named as the source file, created in a progressively indexed subdirectory e.g. <code class="docutils literal notranslate"><span class="pre">dir01/</span></code>, <code class="docutils literal notranslate"><span class="pre">dir02/</span></code>, etc.</td>
</tr>
<tr class="row-odd"><td>many</td>
<td><code class="docutils literal notranslate"><span class="pre">dir*/*</span></code></td>
<td>(as above)</td>
</tr>
</tbody>
</table>
<p>以下片段显示了如何在输入文件声明中使用通配符:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fasta</span> <span class="o">=</span> <span class="n">Channel</span><span class="o">.</span><span class="n">fromPath</span><span class="p">(</span> <span class="s2">&quot;/some/path/*.fa&quot;</span> <span class="p">)</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">size</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span>

<span class="n">process</span> <span class="n">blastThemAll</span> <span class="p">{</span>
    <span class="nb">input</span><span class="p">:</span>
    <span class="n">file</span> <span class="s1">&#39;seq?.fa&#39;</span> <span class="kn">from</span> <span class="nn">fasta</span>

    <span class="s2">&quot;cat seq1.fa seq2.fa seq3.fa&quot;</span>

<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">根据命名模式重写输入文件名是一项额外功能，完全没有义务。 “文件输入”部分中引入的普通文件输入结构也适用于多个文件的集合。 要处理保留原始文件名的多个输入文件，请使用 <code class="docutils literal notranslate"><span class="pre">*</span></code> 通配符作为名称模式或变量标识符。</p>
</div>
</div>
<div class="section" id="id9">
<h3>动态输入文件名<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h3>
<p>使用 <code class="docutils literal notranslate"><span class="pre">name</span></code>  文件子句或短字符串表示法指定输入文件名时，可以使用其他输入值作为文件名字符串中的变量。 例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">simpleCount</span> <span class="p">{</span>
  <span class="nb">input</span><span class="p">:</span>
  <span class="n">val</span> <span class="n">x</span> <span class="kn">from</span> <span class="nn">species</span>
  <span class="n">file</span> <span class="s2">&quot;$</span><span class="si">{x}</span><span class="s2">.fa&quot;</span> <span class="kn">from</span> <span class="nn">genomes</span>

  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  cat ${x}.fa | grep &#39;&gt;&#39;</span>
<span class="sd">  &quot;&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>在上面的示例中，使用 <code class="docutils literal notranslate"><span class="pre">x</span></code> 输入值的当前值设置输入文件名。</p>
<p>这允许输入文件在脚本工作目录中暂存，其名称与当前执行上下文一致。</p>
<div class="admonition tip">
<p class="first admonition-title">小技巧</p>
<p class="last">在大多数情况下，您不需要使用动态文件名，因为每个进程都在其自己的专用临时目录中执行，并且输入文件由Nextflow自动转移到此目录。 这可以保证具有相同名称的输入文件不会相互覆盖。</p>
</div>
</div>
<div class="section" id="stdin">
<h3>输入’stdin’类型<a class="headerlink" href="#stdin" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">stdin</span></code> 输入限定符允许您将从channel接收的值转发到process执行的命令的 <a class="reference external" href="http://en.wikipedia.org/wiki/Standard_streams#Standard_input_.28stdin.29">standard input</a> 。
例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">str</span> <span class="o">=</span> <span class="n">Channel</span><span class="o">.</span><span class="n">from</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="s1">&#39;hola&#39;</span><span class="p">,</span> <span class="s1">&#39;bonjour&#39;</span><span class="p">,</span> <span class="s1">&#39;ciao&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">it</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="p">}</span>

<span class="n">process</span> <span class="n">printAll</span> <span class="p">{</span>
   <span class="nb">input</span><span class="p">:</span>
   <span class="n">stdin</span> <span class="nb">str</span>

   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   cat -</span>
<span class="sd">   &quot;&quot;&quot;</span>

<span class="p">}</span>
</pre></div>
</div>
<p>It will output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hola</span>
<span class="n">bonjour</span>
<span class="n">ciao</span>
<span class="n">hello</span>
</pre></div>
</div>
</div>
<div class="section" id="env">
<h3>输入’env’类型<a class="headerlink" href="#env" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">env</span></code> 限定符允许您根据从channel接收的值在process执行上下文中定义环境变量。 例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">str</span> <span class="o">=</span> <span class="n">Channel</span><span class="o">.</span><span class="n">from</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="s1">&#39;hola&#39;</span><span class="p">,</span> <span class="s1">&#39;bonjour&#39;</span><span class="p">,</span> <span class="s1">&#39;ciao&#39;</span><span class="p">)</span>

<span class="n">process</span> <span class="n">printEnv</span> <span class="p">{</span>

    <span class="nb">input</span><span class="p">:</span>
    <span class="n">env</span> <span class="n">HELLO</span> <span class="kn">from</span> <span class="nn">str</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    echo $HELLO world!</span>
<span class="sd">    &#39;&#39;&#39;</span>

<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>hello world!
ciao world!
bonjour world!
hola world!
</pre></div>
</div>
</div>
<div class="section" id="set">
<h3>输入’set’类型<a class="headerlink" href="#set" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">set</span></code> 限定符允许您在单个参数定义中对多个参数进行分组。 当process在输入中接收需要单独处理的值的元组时，它会很有用。 元组中的每个元素都与具有 <code class="docutils literal notranslate"><span class="pre">set</span></code> 定义的对应元素相关联。 例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">tuple</span> <span class="o">=</span> <span class="n">Channel</span><span class="o">.</span><span class="n">from</span><span class="p">(</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;beta&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;delta&#39;</span><span class="p">]</span> <span class="p">)</span>

<span class="n">process</span> <span class="n">setExample</span> <span class="p">{</span>
    <span class="nb">input</span><span class="p">:</span>
    <span class="nb">set</span> <span class="n">val</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">file</span><span class="p">(</span><span class="s1">&#39;latin.txt&#39;</span><span class="p">)</span>  <span class="kn">from</span> <span class="nn">tuple</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    echo Processing $x</span>
<span class="sd">    cat - latin.txt &gt; copy</span>
<span class="sd">    &quot;&quot;&quot;</span>

<span class="p">}</span>
</pre></div>
</div>
<p>在上面的示例中，<code class="docutils literal notranslate"><span class="pre">set</span></code> 参数用于定义值 <code class="docutils literal notranslate"><span class="pre">x</span></code> 和文件 <code class="docutils literal notranslate"><span class="pre">latin.txt</span></code>，后者将从同一channel中接收值。</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">set</span></code> declaration items can be defined by using the following qualifiers: <code class="docutils literal notranslate"><span class="pre">val</span></code>, <code class="docutils literal notranslate"><span class="pre">env</span></code>, <code class="docutils literal notranslate"><span class="pre">file</span></code> and <code class="docutils literal notranslate"><span class="pre">stdin</span></code>.
在 <code class="docutils literal notranslate"><span class="pre">set</span></code> 声明中，可以使用以下限定符来定义项：<code class="docutils literal notranslate"><span class="pre">val</span></code>, <code class="docutils literal notranslate"><span class="pre">env</span></code>, <code class="docutils literal notranslate"><span class="pre">file</span></code> 和 <code class="docutils literal notranslate"><span class="pre">stdin</span></code></p>
<p>通过应用以下替换规则可以使用更短的表示法：</p>
<table border="1" class="docutils">
<colgroup>
<col width="47%" />
<col width="53%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">long</th>
<th class="head">short</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>val(x)</td>
<td>x</td>
</tr>
<tr class="row-odd"><td>file(x)</td>
<td>(not supported)</td>
</tr>
<tr class="row-even"><td>file(‘name’)</td>
<td>‘name’</td>
</tr>
<tr class="row-odd"><td>file(x:’name’)</td>
<td>x:’name’</td>
</tr>
<tr class="row-even"><td>stdin</td>
<td>‘-‘</td>
</tr>
<tr class="row-odd"><td>env(x)</td>
<td>(not supported)</td>
</tr>
</tbody>
</table>
<p>因此，前面的示例可以重写如下:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">tuple</span> <span class="o">=</span> <span class="n">Channel</span><span class="o">.</span><span class="n">from</span><span class="p">(</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;beta&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;delta&#39;</span><span class="p">]</span> <span class="p">)</span>

<span class="n">process</span> <span class="n">setExample</span> <span class="p">{</span>
    <span class="nb">input</span><span class="p">:</span>
    <span class="nb">set</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;latin.txt&#39;</span> <span class="kn">from</span> <span class="nn">tuple</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    echo Processing $x</span>
<span class="sd">    cat - latin.txt &gt; copy</span>
<span class="sd">    &quot;&quot;&quot;</span>

<span class="p">}</span>
</pre></div>
</div>
<p>文件名可以 <em>动态方式</em> 定义，如  <a class="reference internal" href="#id9">动态输入文件名</a>  部分所述。</p>
</div>
<div class="section" id="id10">
<h3>重复输入<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">each</span></code> 限定符允许您在每次收到新数据时为集合中的每个项重复执行过程。 例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sequences</span> <span class="o">=</span> <span class="n">Channel</span><span class="o">.</span><span class="n">fromPath</span><span class="p">(</span><span class="s1">&#39;*.fa&#39;</span><span class="p">)</span>
<span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;regular&#39;</span><span class="p">,</span> <span class="s1">&#39;expresso&#39;</span><span class="p">,</span> <span class="s1">&#39;psicoffee&#39;</span><span class="p">]</span>

<span class="n">process</span> <span class="n">alignSequences</span> <span class="p">{</span>
  <span class="nb">input</span><span class="p">:</span>
  <span class="n">file</span> <span class="n">seq</span> <span class="kn">from</span> <span class="nn">sequences</span>
  <span class="n">each</span> <span class="n">mode</span> <span class="kn">from</span> <span class="nn">methods</span>

  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  t_coffee -in $seq -mode $mode &gt; result</span>
<span class="sd">  &quot;&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>在上述示例中，每当过程接收到序列文件作为输入时，它执行三个任务，运行具有  <code class="docutils literal notranslate"><span class="pre">mode</span></code> 参数的不同值的T-coffee比对。 当您需要为给定的参数集重复相同的任务时，这非常有用。</p>
<p>从版本0.25+开始，重复输入也可以应用于文件。 例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sequences</span> <span class="o">=</span> <span class="n">Channel</span><span class="o">.</span><span class="n">fromPath</span><span class="p">(</span><span class="s1">&#39;*.fa&#39;</span><span class="p">)</span>
<span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;regular&#39;</span><span class="p">,</span> <span class="s1">&#39;expresso&#39;</span><span class="p">]</span>
<span class="n">libraries</span> <span class="o">=</span> <span class="p">[</span> <span class="n">file</span><span class="p">(</span><span class="s1">&#39;PQ001.lib&#39;</span><span class="p">),</span> <span class="n">file</span><span class="p">(</span><span class="s1">&#39;PQ002.lib&#39;</span><span class="p">),</span> <span class="n">file</span><span class="p">(</span><span class="s1">&#39;PQ003.lib&#39;</span><span class="p">)</span> <span class="p">]</span>

<span class="n">process</span> <span class="n">alignSequences</span> <span class="p">{</span>
  <span class="nb">input</span><span class="p">:</span>
  <span class="n">file</span> <span class="n">seq</span> <span class="kn">from</span> <span class="nn">sequences</span>
  <span class="n">each</span> <span class="n">mode</span> <span class="kn">from</span> <span class="nn">methods</span>
  <span class="n">each</span> <span class="n">file</span><span class="p">(</span><span class="n">lib</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">libraries</span>

  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  t_coffee -in $seq -mode $mode -lib $lib &gt; result</span>
<span class="sd">  &quot;&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">当声明多个重复时，process将为它们的每个组合执行。</p>
</div>
<p>在后一示例中，对于 <code class="docutils literal notranslate"><span class="pre">sequences</span></code> channel发出的任何序列输入文件，执行6个比对，3个使用 <code class="docutils literal notranslate"><span class="pre">regular</span></code> 方法对每个库文件执行，而其他3个通过使用 <code class="docutils literal notranslate"><span class="pre">expresso</span></code> 方法。</p>
<div class="admonition hint">
<p class="first admonition-title">提示</p>
<p class="last">如果需要在n元组元素上重复执行进程而不是简单的值或文件，请根据需要创建一个组合输入值的channel，以多次触发process执行。 在这方面，请参阅 <a class="reference internal" href="operator.html#operator-combine"><span class="std std-ref">combine</span></a>, <a class="reference internal" href="operator.html#operator-cross"><span class="std std-ref">cross</span></a> 和 <a class="reference internal" href="operator.html#operator-phase"><span class="std std-ref">phase</span></a> 运算符。</p>
</div>
</div>
<div class="section" id="channels">
<span id="process-understand-how-multiple-input-channels-work"></span><h3>了解多个输入channels的工作原理<a class="headerlink" href="#channels" title="永久链接至标题">¶</a></h3>
<p>processes的一个关键特性是能够处理来自多个channels的输入。</p>
<p>当两个或多个channels被声明为process输入时，process将停止，直到有完整的输入配置，即它从声明为输入的所有channels接收输入值。</p>
<p>当验证该条件时，它消耗来自各个channels的输入值，并产生任务执行，然后重复相同的逻辑，直到一个或多个channels不再有内容。</p>
<p>这意味着channel一个接一个地串行消耗，第一个空channel导致进程执行停止，即使其他channels中还有其他值。</p>
<p>例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">foo</span> <span class="p">{</span>
  <span class="n">echo</span> <span class="n">true</span>
  <span class="nb">input</span><span class="p">:</span>
  <span class="n">val</span> <span class="n">x</span> <span class="kn">from</span> <span class="nn">Channel.from</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
  <span class="n">val</span> <span class="n">y</span> <span class="kn">from</span> <span class="nn">Channel.from</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">)</span>
  <span class="n">script</span><span class="p">:</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   echo $x and $y</span>
<span class="sd">   &quot;&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>process <code class="docutils literal notranslate"><span class="pre">foo</span></code> 执行两次，因为第一个输入channel只提供两个值，因此丢弃了 <code class="docutils literal notranslate"><span class="pre">c</span></code> 元素。 它打印:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span> <span class="ow">and</span> <span class="n">a</span>
<span class="mi">2</span> <span class="ow">and</span> <span class="n">b</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last">在使用值通道(<em>Value channel</em>)时应用了另一种语义，即单例通道(<em>Singleton channel</em>)。</p>
</div>
<p>这种channel由 <a class="reference internal" href="channel.html#channel-value"><span class="std std-ref">Channel.value</span></a> factory方法创建，或者在process输入指定 <code class="docutils literal notranslate"><span class="pre">from</span></code> 子句中的简单值时隐式创建。</p>
<p>根据定义， <em>Value channel</em> 绑定到单个值，可以无限次读取而不消耗其内容。</p>
<p>这些属性使得在将value channel与一个或多个（队列）channels混合时，它不会影响仅仅依赖于其他channels并且其内容被重复应用的process终止。</p>
<p>为了更好地理解此行为，请将前一个示例与以下示例进行比较:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">bar</span> <span class="p">{</span>
  <span class="n">echo</span> <span class="n">true</span>
  <span class="nb">input</span><span class="p">:</span>
  <span class="n">val</span> <span class="n">x</span> <span class="kn">from</span> <span class="nn">Channel.value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">val</span> <span class="n">y</span> <span class="kn">from</span> <span class="nn">Channel.from</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">)</span>
  <span class="n">script</span><span class="p">:</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   echo $x and $y</span>
<span class="sd">   &quot;&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>上面的代码段执行 <code class="docutils literal notranslate"><span class="pre">bar</span></code>  process三次，因为第一个输入是一个value channel，因此可以根据需要多次读取其内容。 process终止由第二channel的内容确定。它打印:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span> <span class="ow">and</span> <span class="n">a</span>
<span class="mi">1</span> <span class="ow">and</span> <span class="n">b</span>
<span class="mi">1</span> <span class="ow">and</span> <span class="n">c</span>
</pre></div>
</div>
<p>See also: <a class="reference internal" href="channel.html#channel-types"><span class="std std-ref">Channel types</span></a>.</p>
</div>
</div>
<div class="section" id="id11">
<h2>输出<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">output</span></code> 声明块允许定义process用于发送生成结果的channels。</p>
<p>它最多可以定义一个输出块，它可以包含一个或多个输出声明。 输出块遵循以下语法:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">output</span><span class="p">:</span>
  <span class="o">&lt;</span><span class="n">output</span> <span class="n">qualifier</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">output</span> <span class="n">name</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">into</span> <span class="o">&lt;</span><span class="n">target</span> <span class="n">channel</span><span class="o">&gt;</span><span class="p">[,</span><span class="n">channel</span><span class="p">,</span><span class="o">..</span><span class="p">]]</span> <span class="p">[</span><span class="n">attribute</span> <span class="p">[,</span><span class="o">..</span><span class="p">]]</span>
</pre></div>
</div>
<p>输出定义以输出限定符和输出名称开头，后跟关键字 <code class="docutils literal notranslate"><span class="pre">into</span></code> 以及发送输出的一个或多个channels。 最后，可以指定一些可选属性。</p>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">当输出名称与channel名称相同时，可以省略 <code class="docutils literal notranslate"><span class="pre">into</span></code> 声明的部分内容。</p>
</div>
<p>可以在输出声明块中使用的限定符是下表中列出的限定符：</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Qualifier</th>
<th class="head">Semantic</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>val</td>
<td>Sends variable’s with the name specified over the output channel.</td>
</tr>
<tr class="row-odd"><td>file</td>
<td>Sends a file produced by the process with the name specified over the output channel.</td>
</tr>
<tr class="row-even"><td>stdout</td>
<td>Sends the executed process <cite>stdout</cite> over the output channel.</td>
</tr>
<tr class="row-odd"><td>set</td>
<td>Lets to send multiple values over the same output channel.</td>
</tr>
</tbody>
</table>
<div class="section" id="output-values">
<h3>Output values<a class="headerlink" href="#output-values" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">val</span></code> 限定符允许输出脚本上下文中定义的值。 在常见的使用场景中，这是一个已在输入声明块中定义的值，如以下示例所示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;prot&#39;</span><span class="p">,</span><span class="s1">&#39;dna&#39;</span><span class="p">,</span> <span class="s1">&#39;rna&#39;</span><span class="p">]</span>

<span class="n">process</span> <span class="n">foo</span> <span class="p">{</span>
  <span class="nb">input</span><span class="p">:</span>
  <span class="n">val</span> <span class="n">x</span> <span class="kn">from</span> <span class="nn">methods</span>

  <span class="n">output</span><span class="p">:</span>
  <span class="n">val</span> <span class="n">x</span> <span class="n">into</span> <span class="n">receiver</span>

  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  echo $x &gt; file</span>
<span class="sd">  &quot;&quot;&quot;</span>

<span class="p">}</span>

<span class="n">receiver</span><span class="o">.</span><span class="n">println</span> <span class="p">{</span> <span class="s2">&quot;Received: $it&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>有效输出值是文字，输入值标识符，进程范围和值表达式中可访问的变量。 例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">foo</span> <span class="p">{</span>
  <span class="nb">input</span><span class="p">:</span>
  <span class="n">file</span> <span class="n">fasta</span> <span class="kn">from</span> <span class="s1">&#39;dummy&#39;</span>

  <span class="n">output</span><span class="p">:</span>
  <span class="n">val</span> <span class="n">x</span> <span class="n">into</span> <span class="n">var_channel</span>
  <span class="n">val</span> <span class="s1">&#39;BB11&#39;</span> <span class="n">into</span> <span class="n">str_channel</span>
  <span class="n">val</span> <span class="s2">&quot;$</span><span class="si">{fasta.baseName}</span><span class="s2">.out&quot;</span> <span class="n">into</span> <span class="n">exp_channel</span>

  <span class="n">script</span><span class="p">:</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">fasta</span><span class="o">.</span><span class="n">name</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  cat $x &gt; file</span>
<span class="sd">  &quot;&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="output-files">
<h3>Output files<a class="headerlink" href="#output-files" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">file</span></code> 限定符允许通过指定的channel输出由process生成的一个或多个文件。 例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">randomNum</span> <span class="p">{</span>

   <span class="n">output</span><span class="p">:</span>
   <span class="n">file</span> <span class="s1">&#39;result.txt&#39;</span> <span class="n">into</span> <span class="n">numbers</span>

   <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">   echo $RANDOM &gt; result.txt</span>
<span class="sd">   &#39;&#39;&#39;</span>

<span class="p">}</span>

<span class="n">numbers</span><span class="o">.</span><span class="n">subscribe</span> <span class="p">{</span> <span class="n">println</span> <span class="s2">&quot;Received: &quot;</span> <span class="o">+</span> <span class="n">it</span><span class="o">.</span><span class="n">text</span> <span class="p">}</span>
</pre></div>
</div>
<p>在上面的示例中，该过程在执行时会创建一个名为 <code class="docutils literal notranslate"><span class="pre">result.txt</span></code> 的文件，其中包含一个随机数。 由于在输出之间声明了使用相同名称的文件参数，因此当任务完成时，该文件通过 <code class="docutils literal notranslate"><span class="pre">numbers</span></code>  channel发送。 声明与输入相同的channel的下游process将能够接收它。</p>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">如果先前未在pipeline脚本中声明指定为输出的channel，则它将由输出声明本身隐式创建。</p>
</div>
</div>
<div class="section" id="multiple-output-files">
<h3>Multiple output files<a class="headerlink" href="#multiple-output-files" title="永久链接至标题">¶</a></h3>
<p>当输出文件名包含 <code class="docutils literal notranslate"><span class="pre">*</span></code> 或 <code class="docutils literal notranslate"><span class="pre">?</span></code> 时 通配符，它被解释为  <a class="reference external" href="http://docs.oracle.com/javase/tutorial/essential/io/fileOps.html#glob">glob</a>  路径匹配器。 这允许将多个文件捕获到列表对象中并将它们作为唯一的输出。 例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">splitLetters</span> <span class="p">{</span>

    <span class="n">output</span><span class="p">:</span>
    <span class="n">file</span> <span class="s1">&#39;chunk_*&#39;</span> <span class="n">into</span> <span class="n">letters</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    printf &#39;Hola&#39; | split -b 1 - chunk_</span>
<span class="sd">    &#39;&#39;&#39;</span>
<span class="p">}</span>

<span class="n">letters</span>
    <span class="o">.</span><span class="n">flatMap</span><span class="p">()</span>
    <span class="o">.</span><span class="n">subscribe</span> <span class="p">{</span> <span class="n">println</span> <span class="s2">&quot;File: $</span><span class="si">{it.name}</span><span class="s2"> =&gt; $</span><span class="si">{it.text}</span><span class="s2">&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>It prints:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">File</span><span class="p">:</span> <span class="n">chunk_aa</span> <span class="o">=&gt;</span> <span class="n">H</span>
<span class="n">File</span><span class="p">:</span> <span class="n">chunk_ab</span> <span class="o">=&gt;</span> <span class="n">o</span>
<span class="n">File</span><span class="p">:</span> <span class="n">chunk_ac</span> <span class="o">=&gt;</span> <span class="n">l</span>
<span class="n">File</span><span class="p">:</span> <span class="n">chunk_ad</span> <span class="o">=&gt;</span> <span class="n">a</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">在上面的示例中，运算符 <a class="reference internal" href="operator.html#operator-flatmap"><span class="std std-ref">flatMap</span></a> 用于将 <code class="docutils literal notranslate"><span class="pre">letters</span></code> channel发出的文件列表转换为独立发送每个文件对象的channel。</p>
</div>
<p>关于glob模式行为的一些警告：
* 输入文件不包含在可能的匹配列表中。
* Glob模式匹配文件和目录路径。
* 当两星模式 <code class="docutils literal notranslate"><span class="pre">**</span></code> 用于跨目录匹配时，只匹配文件路径，即目录不包括在结果列表中。</p>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last">尽管与结果输出channel匹配的输入文件未包含在结果输出channel中，但这些文件仍可从任务暂存目录传输到目标任务工作目录。 因此，为避免不必要的文件复制，建议在定义输出文件时避免使用松散的通配符，例如 <code class="docutils literal notranslate"><span class="pre">file</span> <span class="pre">'*'</span></code> 。 相反，使用前缀或后缀命名符号将匹配文件集限制为仅预期的匹配文件，例如 <code class="docutils literal notranslate"><span class="pre">file</span> <span class="pre">'prefix_*.sorted.ba'</span></code>。</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">小技巧</p>
<p class="last">默认情况下，所有与指定的glob模式匹配的文件都由channel作为唯一（列表）项发出。 通过在输出文件声明中添加 <code class="docutils literal notranslate"><span class="pre">mode</span> <span class="pre">flatten</span></code> 属性，还可以将每个文件作为唯一项输出。</p>
</div>
<p>通过使用mode属性，可以重写上一个示例，如下所示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">splitLetters</span> <span class="p">{</span>

    <span class="n">output</span><span class="p">:</span>
    <span class="n">file</span> <span class="s1">&#39;chunk_*&#39;</span> <span class="n">into</span> <span class="n">letters</span> <span class="n">mode</span> <span class="n">flatten</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    printf &#39;Hola&#39; | split -b 1 - chunk_</span>
<span class="sd">    &#39;&#39;&#39;</span>
<span class="p">}</span>

<span class="n">letters</span> <span class="o">.</span><span class="n">subscribe</span> <span class="p">{</span> <span class="n">println</span> <span class="s2">&quot;File: $</span><span class="si">{it.name}</span><span class="s2"> =&gt; $</span><span class="si">{it.text}</span><span class="s2">&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>Read more about glob syntax at the following link <a class="reference external" href="http://docs.oracle.com/javase/tutorial/essential/io/fileOps.html#glob">What is a glob?</a></p>
</div>
<div class="section" id="process-dynoutname">
<span id="id12"></span><h3>动态输出文件名<a class="headerlink" href="#process-dynoutname" title="永久链接至标题">¶</a></h3>
<p>当需要动态表示输出文件名时，可以使用动态计算字符串来定义它，该字符串引用在输入声明块或脚本全局上下文中定义的值。 例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">align</span> <span class="p">{</span>
  <span class="nb">input</span><span class="p">:</span>
  <span class="n">val</span> <span class="n">x</span> <span class="kn">from</span> <span class="nn">species</span>
  <span class="n">file</span> <span class="n">seq</span> <span class="kn">from</span> <span class="nn">sequences</span>

  <span class="n">output</span><span class="p">:</span>
  <span class="n">file</span> <span class="s2">&quot;$</span><span class="si">{x}</span><span class="s2">.aln&quot;</span> <span class="n">into</span> <span class="n">genomes</span>

  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  t_coffee -in $seq &gt; ${x}.aln</span>
<span class="sd">  &quot;&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>在上面的示例中，每次执行该process时，都会生成一个比对文件，其名称取决于 <code class="docutils literal notranslate"><span class="pre">x</span></code> 输入的实际值。</p>
<div class="admonition tip">
<p class="first admonition-title">小技巧</p>
<p>使用Nextflow时，输出文件的管理是一个非常常见的误解。使用其他工具时，通常需要将输出文件组织成某种目录结构或保证唯一的文件名方案，以便结果文件不会相互覆盖，并且可以由下游任务单独引用它们。</p>
<p>使用Nextflow，在大多数情况下，您不需要处理命名输出文件，因为每个任务都在其自己唯一的临时目录中执行，因此由不同任务生成的文件永远不会相互覆盖。此外，元数据可以通过使用  <a class="reference internal" href="#process-set"><span class="std std-ref">set output</span></a> 限定符与输出相关联，而不是将它们包含在输出文件名中。</p>
<p class="last">总而言之，尽可能使用具有静态名称的输出文件而不是动态名称，因为它将导致更简单和更可移植的代码。</p>
</div>
</div>
<div class="section" id="stdout">
<span id="process-stdout"></span><h3>输出 ‘stdout’ 特殊文件<a class="headerlink" href="#stdout" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">stdout</span></code> 限定符允许捕获已执行进程的stdout输出，并通过输出参数声明中指定channel发送它。 例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">echoSomething</span> <span class="p">{</span>
    <span class="n">output</span><span class="p">:</span>
    <span class="n">stdout</span> <span class="n">channel</span>

    <span class="s2">&quot;echo Hello world!&quot;</span>

<span class="p">}</span>

<span class="n">channel</span><span class="o">.</span><span class="n">subscribe</span> <span class="p">{</span> <span class="nb">print</span> <span class="s2">&quot;I say..  $it&quot;</span> <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="process-set">
<span id="id13"></span><h3>输出’set’值<a class="headerlink" href="#process-set" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">set</span></code> 限定符允许将多个值发送到单个channel。 当您需要将同一process的多次执行结果组合在一起时，此功能非常有用，如以下示例所示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="n">Channel</span><span class="o">.</span><span class="n">fromPath</span> <span class="s1">&#39;*.fa&#39;</span>
<span class="n">species</span> <span class="o">=</span> <span class="n">Channel</span><span class="o">.</span><span class="kn">from</span> <span class="s1">&#39;human&#39;</span><span class="p">,</span> <span class="s1">&#39;cow&#39;</span><span class="p">,</span> <span class="s1">&#39;horse&#39;</span>

<span class="n">process</span> <span class="n">blast</span> <span class="p">{</span>

<span class="nb">input</span><span class="p">:</span>
    <span class="n">val</span> <span class="n">species</span>
    <span class="n">file</span> <span class="n">query</span>

<span class="n">output</span><span class="p">:</span>
    <span class="nb">set</span> <span class="n">val</span><span class="p">(</span><span class="n">species</span><span class="p">),</span> <span class="n">file</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">)</span> <span class="n">into</span> <span class="n">blastOuts</span>


<span class="s2">&quot;blast -db nr -query $query&quot;</span> <span class="o">&gt;</span> <span class="n">result</span>

<span class="p">}</span>
</pre></div>
</div>
<p>在上面的示例中，针对接收的每对 <code class="docutils literal notranslate"><span class="pre">species</span></code>  和 <code class="docutils literal notranslate"><span class="pre">query</span></code> 执行BLAST任务。 当任务完成一个包含 <code class="docutils literal notranslate"><span class="pre">species</span></code> 值的新元组时， <code class="docutils literal notranslate"><span class="pre">result</span></code> 文件将被发送到 <code class="docutils literal notranslate"><span class="pre">blastOuts</span></code>  channel。</p>
<p>set声明可以包含以下描述的以下限定符的任意组合： <code class="docutils literal notranslate"><span class="pre">val</span></code>, <code class="docutils literal notranslate"><span class="pre">file</span></code> 和 <code class="docutils literal notranslate"><span class="pre">stdout</span></code>.</p>
<div class="admonition tip">
<p class="first admonition-title">小技巧</p>
<p>变量标识符被解释为值，而字符串文字默认被解释为文件，因此可以使用短符号重写上述输出集，如下所示。</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">output</span><span class="p">:</span>
    <span class="nb">set</span> <span class="n">species</span><span class="p">,</span> <span class="s1">&#39;result&#39;</span> <span class="n">into</span> <span class="n">blastOuts</span>
</pre></div>
</div>
</div>
<p>文件名可以动态方式定义，如  <a class="reference internal" href="#process-dynoutname"><span class="std std-ref">动态输出文件名</span></a> 分所述。</p>
</div>
<div class="section" id="id14">
<h3>可选输出<a class="headerlink" href="#id14" title="永久链接至标题">¶</a></h3>
<p>在大多数情况下，一个process会生成添加到输出channel的输出。 但是，有些情况下，process无法生成输出。 在这些情况下，可以将 <code class="docutils literal notranslate"><span class="pre">optional</span> <span class="pre">true</span></code> 添加到输出声明中，如果未创建声明的输出，则声明Nextflow不会使进程失败。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">output</span><span class="p">:</span>
    <span class="n">file</span><span class="p">(</span><span class="s2">&quot;output.txt&quot;</span><span class="p">)</span> <span class="n">optional</span> <span class="n">true</span> <span class="n">into</span> <span class="n">outChannel</span>
</pre></div>
</div>
<p>在此示例中，通常期望该process生成  <code class="docutils literal notranslate"><span class="pre">output.txt</span></code>  文件，但在文件合法丢失的情况下，该进程不会失败。  <code class="docutils literal notranslate"><span class="pre">outChannel</span></code> 仅由生成 <code class="docutils literal notranslate"><span class="pre">output.txt</span></code> 的processes填充。</p>
</div>
</div>
<div class="section" id="when">
<h2>When<a class="headerlink" href="#when" title="永久链接至标题">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">when</span></code> 声明允许您定义必须在验证条件下才能执行该process。 这可以是任何计算布尔值的表达式。</p>
<p>根据各种输入和参数的状态启用/禁用process执行非常有用。 例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">find</span> <span class="p">{</span>
  <span class="nb">input</span><span class="p">:</span>
  <span class="n">file</span> <span class="n">proteins</span>
  <span class="n">val</span> <span class="nb">type</span> <span class="kn">from</span> <span class="nn">dbtype</span>

  <span class="n">when</span><span class="p">:</span>
  <span class="n">proteins</span><span class="o">.</span><span class="n">name</span> <span class="o">=~</span> <span class="o">/^</span><span class="n">BB11</span><span class="o">.*/</span> <span class="o">&amp;&amp;</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;nr&#39;</span>

  <span class="n">script</span><span class="p">:</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  blastp -query $proteins -db nr</span>
<span class="sd">  &quot;&quot;&quot;</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="directives">
<span id="process-directives"></span><h2>Directives<a class="headerlink" href="#directives" title="永久链接至标题">¶</a></h2>
<p>使用directive声明块，您可以提供将影响当前process执行的可选设置。</p>
<p>它们必须在任何其他声明块（即 <code class="docutils literal notranslate"><span class="pre">input</span></code>, <code class="docutils literal notranslate"><span class="pre">output</span></code>, 等）之前输入到process body的顶部，并具有以下语法:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">name</span> <span class="n">value</span> <span class="p">[,</span> <span class="n">value2</span> <span class="p">[,</span><span class="o">..</span><span class="p">]]</span>
</pre></div>
</div>
<p>某些指令通常可用于所有processes，其他指令取决于当前定义的执行程序。</p>
<p>这些指令是：</p>
<ul class="simple">
<li><a class="reference internal" href="#afterscript">afterScript</a></li>
<li><a class="reference internal" href="#beforescript">beforeScript</a></li>
<li><a class="reference internal" href="#cache">cache</a></li>
<li><a class="reference internal" href="#cpus">cpus</a></li>
<li><a class="reference external" href="https://conda.io">conda</a></li>
<li><a class="reference internal" href="#container">container</a></li>
<li><a class="reference internal" href="#containeroptions">containerOptions</a></li>
<li><a class="reference internal" href="#clusteroptions">clusterOptions</a></li>
<li><a class="reference internal" href="#disk">disk</a></li>
<li><a class="reference internal" href="#echo">echo</a></li>
<li><a class="reference internal" href="#errorstrategy">errorStrategy</a></li>
<li><a class="reference internal" href="#executor">executor</a></li>
<li><a class="reference internal" href="#ext">ext</a></li>
<li><a class="reference internal" href="#label">label</a></li>
<li><a class="reference internal" href="#maxerrors">maxErrors</a></li>
<li><a class="reference internal" href="#maxforks">maxForks</a></li>
<li><a class="reference internal" href="#maxretries">maxRetries</a></li>
<li><a class="reference internal" href="#memory">memory</a></li>
<li><a class="reference internal" href="#module">module</a></li>
<li><a class="reference internal" href="#penv">penv</a></li>
<li><a class="reference internal" href="#pod">pod</a></li>
<li><a class="reference internal" href="#publishdir">publishDir</a></li>
<li><a class="reference internal" href="#queue">queue</a></li>
<li><a class="reference internal" href="#scratch">scratch</a></li>
<li><a class="reference internal" href="#stageinmode">stageInMode</a></li>
<li><a class="reference internal" href="#stageoutmode">stageOutMode</a></li>
<li><a class="reference internal" href="#storedir">storeDir</a></li>
<li><a class="reference internal" href="#tag">tag</a></li>
<li><a class="reference internal" href="#time">time</a></li>
<li><a class="reference internal" href="#validexitstatus">validExitStatus</a></li>
</ul>
<div class="section" id="afterscript">
<h3>afterScript<a class="headerlink" href="#afterscript" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">afterScript</span></code>  指令允许您在主进程运行后立即执行自定义（Bash）代码段。 这可能有助于清理您的临时区域。</p>
</div>
<div class="section" id="beforescript">
<h3>beforeScript<a class="headerlink" href="#beforescript" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">beforeScript</span></code> 指令允许您在运行主进程脚本之前执行自定义（Bash）代码段。 这可能对初始化基础集群环境或其他自定义初始化很有用。</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">foo</span> <span class="p">{</span>

  <span class="n">beforeScript</span> <span class="s1">&#39;source /cluster/bin/setup&#39;</span>

  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  echo bar</span>
<span class="sd">  &quot;&quot;&quot;</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="cache">
<h3>cache<a class="headerlink" href="#cache" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">cache</span></code> 指令允许您将进程结果存储到本地缓存。 启用高速缓存并使用 <a class="reference internal" href="getstarted.html#getstart-resume"><span class="std std-ref">resume</span></a> 选项启动pipeline时，执行该过程的任何后续尝试以及相同的输入将导致跳过流程执行，从而将存储的数据生成为实际结果。</p>
<p>缓存功能通过索引进程脚本和输入来生成唯一键。 该密钥用于明确识别process执行产生的输出。</p>
<p>默认情况下启用缓存，您可以通过将 <code class="docutils literal notranslate"><span class="pre">cache</span></code> 指令设置为 <code class="docutils literal notranslate"><span class="pre">false</span></code> 来禁用特定process。 例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">noCacheThis</span> <span class="p">{</span>
  <span class="n">cache</span> <span class="n">false</span>

  <span class="n">script</span><span class="p">:</span>
  <span class="o">&lt;</span><span class="n">your</span> <span class="n">command</span> <span class="n">string</span> <span class="n">here</span><span class="o">&gt;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">cache</span></code> 指令可能的值如下表所示：</p>
<table border="1" class="docutils">
<colgroup>
<col width="8%" />
<col width="93%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">false</span></code></td>
<td>Disable cache feature.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">true</span></code> (default)</td>
<td>Enable caching. Cache keys are created indexing input files meta-data information (name, size and last update timestamp attributes).</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">'deep'</span></code></td>
<td>Enable caching. Cache keys are created indexing input files content.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">'lenient'</span></code></td>
<td>Enable caching. Cache keys are created indexing input files path and size attributes (this policy provides a workaround for incorrect caching invalidation observed on shared file systems due to inconsistent files timestamps; requires version 0.32.x or later).</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="conda">
<span id="process-conda"></span><h3>conda<a class="headerlink" href="#conda" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">conda</span></code> 指令允许使用 <a class="reference external" href="https://conda.io">Conda</a> 包管理器定义process依赖性。</p>
<p>Nextflow自动为 <code class="docutils literal notranslate"><span class="pre">conda</span></code> 指令中列出的给定包名称设置环境。 例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">foo</span> <span class="p">{</span>
  <span class="n">conda</span> <span class="s1">&#39;bwa=0.7.15&#39;</span>

  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  your_command --here</span>
<span class="sd">  &#39;&#39;&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>可以指定多个包，用空格分隔它们，例如: <code class="docutils literal notranslate"><span class="pre">bwa=0.7.15</span> <span class="pre">fastqc=0.11.5</span></code>. 可以使用通常的Conda表示法指定需要下载特定包的channel的名称，即在包之前添加频道名称，如此处所示 <code class="docutils literal notranslate"><span class="pre">bioconda::bwa=0.7.15</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">conda</span></code>  目录还允许指定Conda环境文件路径或现有环境目录的路径。 有关更多详细信息，请参阅  <a class="reference internal" href="conda.html#conda-page"><span class="std std-ref">Conda environments</span></a> 。</p>
</div>
<div class="section" id="container">
<span id="process-container"></span><h3>container<a class="headerlink" href="#container" title="永久链接至标题">¶</a></h3>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">container</span></code> 指令允许您在 <a class="reference external" href="http://docker.io">Docker</a> 容器中执行process脚本。</div></blockquote>
<p>它要求Docker守护程序在执行pipeline的机器中运行，即当通过网格执行器部署pipeline时使用本地执行程序或集群节点时的本地机器。</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">runThisInDocker</span> <span class="p">{</span>

  <span class="n">container</span> <span class="s1">&#39;dockerbox:tag&#39;</span>

  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  &lt;your holy script here&gt;</span>
<span class="sd">  &quot;&quot;&quot;</span>

<span class="p">}</span>
</pre></div>
</div>
<p>只需在上面的脚本 <code class="docutils literal notranslate"><span class="pre">dockerbox:tag</span></code> 中替换您要使用的Docker镜像名称。</p>
<div class="admonition tip">
<p class="first admonition-title">小技巧</p>
<p class="last">这对于将脚本执行到可复制的自包含环境或在云中部署pipeline非常有用。</p>
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">对于本机执行的processes  <a class="reference internal" href="#process-native"><span class="std std-ref">executed natively</span></a>，该指令被忽略。</p>
</div>
</div>
<div class="section" id="containeroptions">
<span id="process-containeroptions"></span><h3>containerOptions<a class="headerlink" href="#containeroptions" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">containerOptions</span></code> 指令允许您指定底层容器引擎支持的任何容器执行选项（即Docker，Singularity等）。这对于仅为特定过程提供容器设置是有用的，例如 安装自定义路径:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">runThisWithDocker</span> <span class="p">{</span>

    <span class="n">container</span> <span class="s1">&#39;busybox:latest&#39;</span>
    <span class="n">containerOptions</span> <span class="s1">&#39;--volume /data/db:/db&#39;</span>

    <span class="n">output</span><span class="p">:</span> <span class="n">file</span> <span class="s1">&#39;output.txt&#39;</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    your_command --data /db &gt; output.txt</span>
<span class="sd">    &#39;&#39;&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last"><a class="reference internal" href="executor.html#awsbatch-executor"><span class="std std-ref">AWS Batch</span></a>  和  <a class="reference internal" href="executor.html#k8s-executor"><span class="std std-ref">Kubernetes</span></a> executors 不支持此功能。</p>
</div>
</div>
<div class="section" id="cpus">
<span id="process-cpus"></span><h3>cpus<a class="headerlink" href="#cpus" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">cpus</span></code> 指令允许您定义process任务所需的（逻辑）CPU数量。 例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">big_job</span> <span class="p">{</span>

  <span class="n">cpus</span> <span class="mi">8</span>
  <span class="n">executor</span> <span class="s1">&#39;sge&#39;</span>

  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  blastp -query input_sequence -num_threads ${task.cpus}</span>
<span class="sd">  &quot;&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>执行多进程或多线程命令/工具的任务需要此指令，并且当通过集群资源管理器执行pipeline任务时，该指令用于保留足够的CPU。</p>
<p>See also: <a class="reference internal" href="#penv">penv</a>, <a class="reference internal" href="#memory">memory</a>, <a class="reference internal" href="#time">time</a>, <a class="reference internal" href="#queue">queue</a>, <a class="reference internal" href="#maxforks">maxForks</a></p>
</div>
<div class="section" id="clusteroptions">
<span id="process-clusteroptions"></span><h3>clusterOptions<a class="headerlink" href="#clusteroptions" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">clusterOptions</span></code>  指令允许使用cluster submit命令接受的任何本机配置选项。 您可以使用它来请求非标准资源或使用特定于您的群集的设置，并且Nextflow不支持开箱即用。</p>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">仅当使用基于网格的执行程序(grid based executor)时才考虑此指令:
<a class="reference internal" href="executor.html#sge-executor"><span class="std std-ref">SGE</span></a>, <a class="reference internal" href="executor.html#lsf-executor"><span class="std std-ref">LSF</span></a>, <a class="reference internal" href="executor.html#slurm-executor"><span class="std std-ref">SLURM</span></a>, <a class="reference internal" href="executor.html#pbs-executor"><span class="std std-ref">PBS/Torque</span></a> and
<a class="reference internal" href="executor.html#condor-executor"><span class="std std-ref">HTCondor</span></a> executors.</p>
</div>
</div>
<div class="section" id="disk">
<span id="process-disk"></span><h3>disk<a class="headerlink" href="#disk" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">disk</span></code> 指令允许您定义允许process使用多少本地磁盘存储。 例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">big_job</span> <span class="p">{</span>

    <span class="n">disk</span> <span class="s1">&#39;2 GB&#39;</span>
    <span class="n">executor</span> <span class="s1">&#39;cirrus&#39;</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    your task script here</span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>指定磁盘值时，可以使用以下内存单元后缀：</p>
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="65%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Unit</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>B</td>
<td>Bytes</td>
</tr>
<tr class="row-odd"><td>KB</td>
<td>Kilobytes</td>
</tr>
<tr class="row-even"><td>MB</td>
<td>Megabytes</td>
</tr>
<tr class="row-odd"><td>GB</td>
<td>Gigabytes</td>
</tr>
<tr class="row-even"><td>TB</td>
<td>Terabytes</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">This directive currently is taken in account only by the <a class="reference internal" href="executor.html#ignite-executor"><span class="std std-ref">Ignite</span></a>
and the <a class="reference internal" href="executor.html#condor-executor"><span class="std std-ref">HTCondor</span></a> executors.</p>
</div>
<p>See also: <a class="reference internal" href="#cpus">cpus</a>, <a class="reference internal" href="#memory">memory</a> <a class="reference internal" href="#time">time</a>, <a class="reference internal" href="#queue">queue</a> and <a class="reference internal" href="#dynamic-computing-resources">Dynamic computing resources</a>.</p>
</div>
<div class="section" id="echo">
<span id="process-echo"></span><h3>echo<a class="headerlink" href="#echo" title="永久链接至标题">¶</a></h3>
<p>默认情况下，所有processes中执行的命令生成的stdout将被忽略。 将 <code class="docutils literal notranslate"><span class="pre">echo</span></code>  指令设置为 <code class="docutils literal notranslate"><span class="pre">true</span></code> ，可以将process stdout转发到当前运行最高的process stdout文件，并在shell终端中显示它。</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">sayHello</span> <span class="p">{</span>
  <span class="n">echo</span> <span class="n">true</span>

  <span class="n">script</span><span class="p">:</span>
  <span class="s2">&quot;echo Hello&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Hello</span>
</pre></div>
</div>
<p>如果不指定  <code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">true</span></code> ，则在执行上述示例时不会看到打印出的 <code class="docutils literal notranslate"><span class="pre">Hello</span></code>  字符串。</p>
</div>
<div class="section" id="errorstrategy">
<span id="process-page-error-strategy"></span><h3>errorStrategy<a class="headerlink" href="#errorstrategy" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">errorStrategy</span></code> 指令允许您定义进程管理错误条件的方式。 默认情况下，执行的脚本返回错误状态时，进程立即停止。 这反过来迫使整个pipeline终止。</p>
<p>可用错误策略表：</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Executor</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">terminate</span></code></td>
<td>Terminates the execution as soon as an error condition is reported. Pending jobs are killed (default)</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">finish</span></code></td>
<td>Initiates an orderly pipeline shutdown when an error condition is raised, waiting the completion of any submitted job.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">ignore</span></code></td>
<td>Ignores processes execution errors.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">retry</span></code></td>
<td>Re-submit for execution a process returning an error condition.</td>
</tr>
</tbody>
</table>
<p>设置 <code class="docutils literal notranslate"><span class="pre">errorStrategy</span></code>  指令为 <code class="docutils literal notranslate"><span class="pre">ignore</span></code> , 进程在错误情况下不会停止时，它只会报告一条消息，通知您错误事件。</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">ignoreAnyError</span> <span class="p">{</span>
   <span class="n">errorStrategy</span> <span class="s1">&#39;ignore&#39;</span>

   <span class="n">script</span><span class="p">:</span>
   <span class="o">&lt;</span><span class="n">your</span> <span class="n">command</span> <span class="n">string</span> <span class="n">here</span><span class="o">&gt;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">小技巧</p>
<p class="last">By definition a command script fails when it ends with a non-zero exit status. To change this behavior
see <a class="reference internal" href="#validexitstatus">validExitStatus</a>.</p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">retry</span></code> 错误策略允许您重新提交执行过程，返回错误条件。 例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">retryIfFail</span> <span class="p">{</span>
   <span class="n">errorStrategy</span> <span class="s1">&#39;retry&#39;</span>

   <span class="n">script</span><span class="p">:</span>
   <span class="o">&lt;</span><span class="n">your</span> <span class="n">command</span> <span class="n">string</span> <span class="n">here</span><span class="o">&gt;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>重新执行失败进程的次数由 <a class="reference internal" href="#maxretries">maxRetries</a> 和 <a class="reference internal" href="#maxerrors">maxErrors</a>  指令定义。</p>
</div>
<div class="section" id="executor">
<span id="process-executor"></span><h3>executor<a class="headerlink" href="#executor" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">executor</span></code> 定义执行进程的底层系统。 默认情况下，process使用 <code class="docutils literal notranslate"><span class="pre">nextflow.config</span></code> 文件中全局定义的执行程序。</p>
<p><code class="docutils literal notranslate"><span class="pre">executor</span></code> 指令允许您配置进程必须使用的执行程序，从而覆盖默认配置。 可以使用以下值：</p>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Executor</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">local</span></code></td>
<td>The process is executed in the computer where <cite>Nextflow</cite> is launched.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">sge</span></code></td>
<td>The process is executed using the Sun Grid Engine / <a class="reference external" href="http://gridscheduler.sourceforge.net/">Open Grid Engine</a>.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">uge</span></code></td>
<td>The process is executed using the <a class="reference external" href="https://en.wikipedia.org/wiki/Univa_Grid_Engine/">Univa Grid Engine</a> job scheduler.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">lsf</span></code></td>
<td>The process is executed using the <a class="reference external" href="http://en.wikipedia.org/wiki/Platform_LSF">Platform LSF</a> job scheduler.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">slurm</span></code></td>
<td>The process is executed using the SLURM job scheduler.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">pbs</span></code></td>
<td>The process is executed using the <a class="reference external" href="http://en.wikipedia.org/wiki/Portable_Batch_System">PBS/Torque</a> job scheduler.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">condor</span></code></td>
<td>The process is executed using the <a class="reference external" href="https://research.cs.wisc.edu/htcondor/">HTCondor</a> job scheduler.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">nqsii</span></code></td>
<td>The process is executed using the <a class="reference external" href="https://www.rz.uni-kiel.de/en/our-portfolio/hiperf/nec-linux-cluster">NQSII</a> job scheduler.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">ignite</span></code></td>
<td>The process is executed using the <a class="reference external" href="https://ignite.apache.org/">Apache Ignite</a> cluster.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">k8s</span></code></td>
<td>The process is executed using the <a class="reference external" href="https://kubernetes.io/">Kubernetes</a> cluster.</td>
</tr>
</tbody>
</table>
<p>The following example shows how to set the process’s executor:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">doSomething</span> <span class="p">{</span>

   <span class="n">executor</span> <span class="s1">&#39;sge&#39;</span>

   <span class="n">script</span><span class="p">:</span>
   <span class="o">&lt;</span><span class="n">your</span> <span class="n">script</span> <span class="n">here</span><span class="o">&gt;</span>

<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">每个执行程序都提供自己的一组配置选项，可以在指令声明块中进行设置。 请参阅 <a class="reference internal" href="executor.html#executor-page"><span class="std std-ref">Executors</span></a> 部分以了解特定执行程序指令。</p>
</div>
</div>
<div class="section" id="ext">
<span id="process-ext"></span><h3>ext<a class="headerlink" href="#ext" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">ext</span></code> 是一个特殊指令，用作用户自定义流程指令的命名空间。 这对高级配置选项很有用。 例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">mapping</span> <span class="p">{</span>
  <span class="n">container</span> <span class="s2">&quot;biocontainers/star:$</span><span class="si">{task.ext.version}</span><span class="s2">&quot;</span>

  <span class="nb">input</span><span class="p">:</span>
  <span class="n">file</span> <span class="n">genome</span> <span class="kn">from</span> <span class="nn">genome_file</span>
  <span class="nb">set</span> <span class="n">sampleId</span><span class="p">,</span> <span class="n">file</span><span class="p">(</span><span class="n">reads</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">reads_ch</span>

  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  STAR --genomeDir $genome --readFilesIn $reads</span>
<span class="sd">  &quot;&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>在上面的示例中，该process使用一个容器，其版本由 <code class="docutils literal notranslate"><span class="pre">ext.version</span></code> 属性控制。 这可以在 <code class="docutils literal notranslate"><span class="pre">nextflow.config</span></code> 文件中定义，如下所示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span><span class="o">.</span><span class="n">ext</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="s1">&#39;2.5.3&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="maxerrors">
<span id="process-maxerrors"></span><h3>maxErrors<a class="headerlink" href="#maxerrors" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">maxErrors</span></code>  指令允许您指定使用 <code class="docutils literal notranslate"><span class="pre">retry</span></code> 错误策略时process可能失败的最大次数。 默认情况下，此指令被禁用，您可以如下例所示进行设置:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">retryIfFail</span> <span class="p">{</span>
  <span class="n">errorStrategy</span> <span class="s1">&#39;retry&#39;</span>
  <span class="n">maxErrors</span> <span class="mi">5</span>

  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  echo &#39;do this as that .. &#39;</span>
<span class="sd">  &quot;&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">此设置考虑了在所有实例中为给定进程累积的总错误。 如果要控制process实例（也称为task）失败的次数，请使用 <code class="docutils literal notranslate"><span class="pre">maxRetries</span></code>。.</p>
</div>
<p>See also: <a class="reference internal" href="#errorstrategy">errorStrategy</a> and <a class="reference internal" href="#maxretries">maxRetries</a>.</p>
</div>
<div class="section" id="maxforks">
<span id="process-maxforks"></span><h3>maxForks<a class="headerlink" href="#maxforks" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">maxForks</span></code>  指令允许您定义可以并行执行的最大process实例数。 默认情况下，此值等于可用CPU核心数减1。</p>
<p>如果要以顺序方式执行process，请将此指令设置为1。 例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">doNotParallelizeIt</span> <span class="p">{</span>

   <span class="n">maxForks</span> <span class="mi">1</span>

   <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">   &lt;your script here&gt;</span>
<span class="sd">   &#39;&#39;&#39;</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="maxretries">
<span id="process-maxretries"></span><h3>maxRetries<a class="headerlink" href="#maxretries" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">maxRetries</span></code> 指令允许您定义在发生故障时可以重新提交process实例的最大次数。 仅在使用 <code class="docutils literal notranslate"><span class="pre">retry</span></code> 错误策略时才应用此值。 默认情况下，只允许重试一次，您可以增加此值，如下所示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">retryIfFail</span> <span class="p">{</span>
    <span class="n">errorStrategy</span> <span class="s1">&#39;retry&#39;</span>
    <span class="n">maxRetries</span> <span class="mi">3</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    echo &#39;do this as that .. &#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">maxRetries</span></code> 和 <code class="docutils literal notranslate"><span class="pre">maxErrors</span></code> 指令之间存在微妙但重要的区别。 后者定义了process执行期间允许的错误总数（同一process可以启动不同的执行实例），而  <code class="docutils literal notranslate"><span class="pre">maxRetries</span></code>  定义了在发生错误时可以重试相同process执行的最大次数。</p>
</div>
<p>See also: <a class="reference internal" href="#errorstrategy">errorStrategy</a> and <a class="reference internal" href="#maxerrors">maxErrors</a>.</p>
</div>
<div class="section" id="memory">
<span id="process-memory"></span><h3>memory<a class="headerlink" href="#memory" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">memory</span></code> 指令允许您定义允许process使用多少内存。 例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">big_job</span> <span class="p">{</span>

    <span class="n">memory</span> <span class="s1">&#39;2 GB&#39;</span>
    <span class="n">executor</span> <span class="s1">&#39;sge&#39;</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    your task script here</span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The following memory unit suffix can be used when specifying the memory value:</p>
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="65%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Unit</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>B</td>
<td>Bytes</td>
</tr>
<tr class="row-odd"><td>KB</td>
<td>Kilobytes</td>
</tr>
<tr class="row-even"><td>MB</td>
<td>Megabytes</td>
</tr>
<tr class="row-odd"><td>GB</td>
<td>Gigabytes</td>
</tr>
<tr class="row-even"><td>TB</td>
<td>Terabytes</td>
</tr>
</tbody>
</table>
<p>See also: <a class="reference internal" href="#cpus">cpus</a>, <a class="reference internal" href="#time">time</a>, <a class="reference internal" href="#queue">queue</a> and <a class="reference internal" href="#dynamic-computing-resources">Dynamic computing resources</a>.</p>
</div>
<div class="section" id="module">
<span id="process-module"></span><h3>module<a class="headerlink" href="#module" title="永久链接至标题">¶</a></h3>
<p><a class="reference external" href="http://modules.sourceforge.net/">Environment Modules</a> 是一个包管理器，允许您动态配置执行环境，并在同一软件工具的多个版本之间轻松切换.</p>
<p>如果它在您的系统中可用，您可以将其与Nextflow一起使用，以便在pipeline中配置process执行环境。</p>
<p>在process定义中，您可以使用 <code class="docutils literal notranslate"><span class="pre">module</span></code> 指令加载要在process执行环境中使用的特定模块版本。 例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">basicExample</span> <span class="p">{</span>

  <span class="n">module</span> <span class="s1">&#39;ncbi-blast/2.2.27&#39;</span>

  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  blastp -query &lt;etc..&gt;</span>
<span class="sd">  &quot;&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>您可以为需要加载的每个模块重复  <code class="docutils literal notranslate"><span class="pre">module</span></code> 指令。 或者，可以在单个 <code class="docutils literal notranslate"><span class="pre">module</span></code> 指令中指定多个模块，方法是使用 <code class="docutils literal notranslate"><span class="pre">:</span></code> (冒号）字符分隔所有模块名称，如下所示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">process</span> <span class="n">manyModules</span> <span class="p">{</span>

   <span class="n">module</span> <span class="s1">&#39;ncbi-blast/2.2.27:t_coffee/10.0:clustalw/2.1&#39;</span>

   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   blastp -query &lt;etc..&gt;</span>
<span class="sd">   &quot;&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="penv">
<span id="process-penv"></span><h3>penv<a class="headerlink" href="#penv" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">penv</span></code> 指令允许您定义在向 <a class="reference internal" href="executor.html#sge-executor"><span class="std std-ref">SGE</span></a> 资源管理器提交并行任务时要使用的并行环境。 例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">big_job</span> <span class="p">{</span>

  <span class="n">cpus</span> <span class="mi">4</span>
  <span class="n">penv</span> <span class="s1">&#39;smp&#39;</span>
  <span class="n">executor</span> <span class="s1">&#39;sge&#39;</span>

  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  blastp -query input_sequence -num_threads ${task.cpus}</span>
<span class="sd">  &quot;&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>此配置取决于Grid Engine安装提供的并行环境。 请参阅您的群集文档或与您的管理员联系以了解更多信息。</p>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">This setting is available when using the <a class="reference internal" href="executor.html#sge-executor"><span class="std std-ref">SGE</span></a> executor.</p>
</div>
<p>See also: <a class="reference internal" href="#cpus">cpus</a>, <a class="reference internal" href="#memory">memory</a>, <a class="reference internal" href="#time">time</a></p>
</div>
<div class="section" id="pod">
<span id="process-pod"></span><h3>pod<a class="headerlink" href="#pod" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">pod</span></code> 指令允许在使用 <a class="reference internal" href="executor.html#k8s-executor"><span class="std std-ref">Kubernetes</span></a> executor 时定义pod特定设置，例如环境变量，机密和配置映射。</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">your_task</span> <span class="p">{</span>
  <span class="n">pod</span> <span class="n">env</span><span class="p">:</span> <span class="s1">&#39;FOO&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span>

  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  echo $FOO</span>
<span class="sd">  &#39;&#39;&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The above snippet defines an environment variable named <code class="docutils literal notranslate"><span class="pre">FOO</span></code> which value is <code class="docutils literal notranslate"><span class="pre">bar</span></code>.
上面的代码片段定义了一个名为 <code class="docutils literal notranslate"><span class="pre">FOO</span></code>  的环境变量，其值为 <code class="docutils literal notranslate"><span class="pre">bar</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">pod</span></code>  指令允许定义以下选项：</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">label:</span> <span class="pre">&lt;K&gt;,</span> <span class="pre">value:</span> <span class="pre">&lt;V&gt;</span></code></td>
<td>Defines a pod label with key <code class="docutils literal notranslate"><span class="pre">K</span></code> and value <code class="docutils literal notranslate"><span class="pre">V</span></code>.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">env:</span> <span class="pre">&lt;E&gt;,</span> <span class="pre">value:</span> <span class="pre">&lt;V&gt;</span></code></td>
<td>Defines an environment variable with name <code class="docutils literal notranslate"><span class="pre">E</span></code> and whose value is given by the <code class="docutils literal notranslate"><span class="pre">V</span></code> string.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">env:</span> <span class="pre">&lt;E&gt;,</span> <span class="pre">config:</span> <span class="pre">&lt;C/K&gt;</span></code></td>
<td>Defines an environment variable with name <code class="docutils literal notranslate"><span class="pre">E</span></code> and whose value is given by the entry associated to the key with name <code class="docutils literal notranslate"><span class="pre">K</span></code> in the <a class="reference external" href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap/">ConfigMap</a> with name <code class="docutils literal notranslate"><span class="pre">C</span></code>.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">env:</span> <span class="pre">&lt;E&gt;,</span> <span class="pre">secret:</span> <span class="pre">&lt;S/K&gt;</span></code></td>
<td>Defines an environment variable with name <code class="docutils literal notranslate"><span class="pre">E</span></code> and whose value is given by the entry associated to the key with name <code class="docutils literal notranslate"><span class="pre">K</span></code> in the <a class="reference external" href="https://kubernetes.io/docs/concepts/configuration/secret/">Secret</a> with name <code class="docutils literal notranslate"><span class="pre">S</span></code>.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">config:</span> <span class="pre">&lt;C/K&gt;,</span> <span class="pre">mountPath:</span> <span class="pre">&lt;/absolute/path&gt;</span></code></td>
<td>The content of the <a class="reference external" href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap/">ConfigMap</a> with name <code class="docutils literal notranslate"><span class="pre">C</span></code> with key <code class="docutils literal notranslate"><span class="pre">K</span></code> is made available to the path <code class="docutils literal notranslate"><span class="pre">/absolute/path</span></code>. When the key component is omitted the path is interpreted as a directory and all the <cite>ConfigMap</cite> entries are exposed in that path.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">secret:</span> <span class="pre">&lt;S/K&gt;,</span> <span class="pre">mountPath:</span> <span class="pre">&lt;/absolute/path&gt;</span></code></td>
<td>The content of the <a class="reference external" href="https://kubernetes.io/docs/concepts/configuration/secret/">Secret</a> with name <code class="docutils literal notranslate"><span class="pre">S</span></code> with key <code class="docutils literal notranslate"><span class="pre">K</span></code> is made available to the path <code class="docutils literal notranslate"><span class="pre">/absolute/path</span></code>. When the key component is omitted the path is interpreted as a directory and all the <cite>Secret</cite> entries are exposed in that path.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">volumeClaim:</span> <span class="pre">&lt;V&gt;,</span> <span class="pre">mountPath:</span> <span class="pre">&lt;/absolute/path&gt;</span></code></td>
<td>Mounts a <a class="reference external" href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/">Persistent volume claim</a> with name <code class="docutils literal notranslate"><span class="pre">V</span></code> to the specified path location. Use the optional <cite>subPath</cite> parameter to mount a directory inside the referenced volume instead of its root.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">imagePullPolicy:</span> <span class="pre">&lt;V&gt;</span></code></td>
<td>Specifies the strategy to be used to pull the container image e.g. <code class="docutils literal notranslate"><span class="pre">imagePullPolicy:</span> <span class="pre">'Always'</span></code>.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">imagePullSecret:</span> <span class="pre">&lt;V&gt;</span></code></td>
<td>Specifies the secret name to access a private container image registry. See <a class="reference external" href="https://kubernetes.io/docs/concepts/containers/images/#specifying-imagepullsecrets-on-a-pod">Kubernetes documentation</a> for details.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">runAsUser:</span> <span class="pre">&lt;UID&gt;</span></code></td>
<td>Specifies the user ID to be used to run the container.</td>
</tr>
</tbody>
</table>
<p>在Nextflow配置文件中定义时，可以使用规范关联数组语法定义pod设置。 例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="p">{</span>
  <span class="n">pod</span> <span class="o">=</span> <span class="p">[</span><span class="n">env</span><span class="p">:</span> <span class="s1">&#39;FOO&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>当需要提供多个设置时，必须将它们包含在列表定义中，如下所示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="p">{</span>
  <span class="n">pod</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="n">env</span><span class="p">:</span> <span class="s1">&#39;FOO&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">secret</span><span class="p">:</span> <span class="s1">&#39;my-secret/key1&#39;</span><span class="p">,</span> <span class="n">mountPath</span><span class="p">:</span> <span class="s1">&#39;/etc/file.txt&#39;</span><span class="p">]</span> <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="publishdir">
<span id="process-publishdir"></span><h3>publishDir<a class="headerlink" href="#publishdir" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">publishDir</span></code> 指令允许您将process输出文件输出到指定的文件夹。 例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">foo</span> <span class="p">{</span>

    <span class="n">publishDir</span> <span class="s1">&#39;/data/chunks&#39;</span>

    <span class="n">output</span><span class="p">:</span>
    <span class="n">file</span> <span class="s1">&#39;chunk_*&#39;</span> <span class="n">into</span> <span class="n">letters</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    printf &#39;Hola&#39; | split -b 1 - chunk_</span>
<span class="sd">    &#39;&#39;&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>上面的示例将字符串 <code class="docutils literal notranslate"><span class="pre">Hola</span></code> 拆分为单个字节的文件块。 完成后， <code class="docutils literal notranslate"><span class="pre">chunk_*</span></code> 输出文件到 <code class="docutils literal notranslate"><span class="pre">/data/chunks</span></code> 文件夹中。</p>
<div class="admonition tip">
<p class="first admonition-title">小技巧</p>
<p class="last">可以多次指定  <code class="docutils literal notranslate"><span class="pre">publishDir</span></code> 指令将输出文件发布到不同的目标目录。 此功能需要0.29.0或更高版本。</p>
</div>
<p>默认情况下，文件将发布到目标文件夹，为每个process输出创建一个符号链接，该链接将生成的文件链接到进程工作目录。 可以使用``mode`` 参数修改此行为。</p>
<p>可与 <code class="docutils literal notranslate"><span class="pre">publishDir</span></code> 指令一起使用的可选参数表:</p>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="91%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>mode</td>
<td>The file publishing method. See the following table for possible values.</td>
</tr>
<tr class="row-odd"><td>overwrite</td>
<td>When <code class="docutils literal notranslate"><span class="pre">true</span></code> any existing file in the specified folder will be overridden (default: <code class="docutils literal notranslate"><span class="pre">true</span></code> during normal
pipeline execution and <code class="docutils literal notranslate"><span class="pre">false</span></code> when pipeline execution is <cite>resumed</cite>).</td>
</tr>
<tr class="row-even"><td>pattern</td>
<td>Specifies a <a class="reference external" href="http://docs.oracle.com/javase/tutorial/essential/io/fileOps.html#glob">glob</a> file pattern that selects which files to publish from the overall set of output files.</td>
</tr>
<tr class="row-odd"><td>path</td>
<td>Specifies the directory where files need to be published. <strong>Note</strong>: the syntax <code class="docutils literal notranslate"><span class="pre">publishDir</span> <span class="pre">'/some/dir'</span></code> is a shortcut for <code class="docutils literal notranslate"><span class="pre">publishDir</span> <span class="pre">path:</span> <span class="pre">'/some/dir'</span></code>.</td>
</tr>
<tr class="row-even"><td>saveAs</td>
<td>A closure which, given the name of the file being published, returns the actual file name or a full path where the file is required to be stored.
This can be used to rename or change the destination directory of the published files dynamically by using
a custom strategy.
Return the value <code class="docutils literal notranslate"><span class="pre">null</span></code> from the closure to <em>not</em> publish a file.
This is useful when the process has multiple output files, but you want to publish only some of them.</td>
</tr>
</tbody>
</table>
<p>Table of publish modes:</p>
<table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="93%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Mode</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>symlink</td>
<td>Creates an absolute <cite>symbolic link</cite> in the published directory for each process output file (default).</td>
</tr>
<tr class="row-odd"><td>rellink</td>
<td>Creates a relative <cite>symbolic link</cite> in the published directory for each process output file.</td>
</tr>
<tr class="row-even"><td>link</td>
<td>Creates a <cite>hard link</cite> in the published directory for each process output file.</td>
</tr>
<tr class="row-odd"><td>copy</td>
<td>Copies the output files into the published directory.</td>
</tr>
<tr class="row-even"><td>copyNoFollow</td>
<td>Copies the output files into the published directory without following symlinks ie. copies the links themselves.</td>
</tr>
<tr class="row-odd"><td>move</td>
<td>Moves the output files into the published directory. <strong>Note</strong>: this is only supposed to be used for a <cite>terminating</cite> process i.e. a process whose output is not consumed by any other downstream process.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">The <cite>mode</cite> value needs to be specified as a string literal i.e. enclosed by quote characters. Multiple parameters
need to be separated by a colon character. For example:</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">foo</span> <span class="p">{</span>

    <span class="n">publishDir</span> <span class="s1">&#39;/data/chunks&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="s1">&#39;copy&#39;</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">:</span> <span class="n">false</span>

    <span class="n">output</span><span class="p">:</span>
    <span class="n">file</span> <span class="s1">&#39;chunk_*&#39;</span> <span class="n">into</span> <span class="n">letters</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    printf &#39;Hola&#39; | split -b 1 - chunk_</span>
<span class="sd">    &#39;&#39;&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last">Files are copied into the specified directory in an <em>asynchronous</em> manner, thus they may not be immediately
available in the published directory at the end of the process execution. For this reason files published by a process
must not be accessed by other downstream processes.</p>
</div>
</div>
<div class="section" id="queue">
<span id="process-queue"></span><h3>queue<a class="headerlink" href="#queue" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">queue</span></code> 目录允许您设置在pipeline中使用基于网格的执行程序时计划作业的队列。 例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">grid_job</span> <span class="p">{</span>

    <span class="n">queue</span> <span class="s1">&#39;long&#39;</span>
    <span class="n">executor</span> <span class="s1">&#39;sge&#39;</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    your task script here</span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>可以通过用逗号分隔它们的名称来指定多个队列，例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">grid_job</span> <span class="p">{</span>

    <span class="n">queue</span> <span class="s1">&#39;short,long,cn-el6&#39;</span>
    <span class="n">executor</span> <span class="s1">&#39;sge&#39;</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    your task script here</span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">This directive is taken in account only by the following executors: <a class="reference internal" href="executor.html#sge-executor"><span class="std std-ref">SGE</span></a>, <a class="reference internal" href="executor.html#lsf-executor"><span class="std std-ref">LSF</span></a>,
<a class="reference internal" href="executor.html#slurm-executor"><span class="std std-ref">SLURM</span></a> and <a class="reference internal" href="executor.html#pbs-executor"><span class="std std-ref">PBS/Torque</span></a> executors.</p>
</div>
</div>
<div class="section" id="label">
<span id="process-label"></span><h3>label<a class="headerlink" href="#label" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">label</span></code> 指令允许使用您选择的助记符标识符对process进行注释。 例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">bigTask</span> <span class="p">{</span>

  <span class="n">label</span> <span class="s1">&#39;big_mem&#39;</span>

  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  &lt;task script&gt;</span>
<span class="sd">  &#39;&#39;&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>相同的标签可以应用于多个process，并且可以使用 <code class="docutils literal notranslate"><span class="pre">label</span></code> 指令多次将多个标签应用于同一process。</p>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">A label must consist of alphanumeric characters or <code class="docutils literal notranslate"><span class="pre">_</span></code>, must start with an alphabetic character
and must end with an alphanumeric character.</p>
</div>
<p>标签对于在单独的组中组织工作process过程非常有用，可以在配置文件中引用它们来选择和配置具有类似计算要求的过程子集。</p>
<p>See the <a class="reference internal" href="config.html#config-process-selectors"><span class="std std-ref">Process选择器</span></a> documentation for details.</p>
</div>
<div class="section" id="scratch">
<span id="process-scratch"></span><h3>scratch<a class="headerlink" href="#scratch" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">scratch</span></code> 指令允许您在执行节点本地的临时文件夹中执行该process。</p>
<p>当您使用网格执行程序启动pipeline时，这非常有用，因为它允许通过在实际执行节点的本地磁盘中的临时目录中运行pipeline进程来减少NFS开销。 只有在process定义中声明为输出的文件才会被复制到pipeline工作区中。</p>
<p>在其基本形式中，只需在指令值中指定 <code class="docutils literal notranslate"><span class="pre">true</span></code>，如下所示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">simpleTask</span> <span class="p">{</span>

  <span class="n">scratch</span> <span class="n">true</span>

  <span class="n">output</span><span class="p">:</span>
  <span class="n">file</span> <span class="s1">&#39;data_out&#39;</span>

  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  &lt;task script&gt;</span>
<span class="sd">  &#39;&#39;&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>通过这样做，它尝试在执行节点中的变量 <code class="docutils literal notranslate"><span class="pre">$TMPDIR</span></code> 定义的目录中执行脚本。 如果此变量不存在，它将使用Linux命令 <code class="docutils literal notranslate"><span class="pre">mktemp</span></code> 创建一个新的临时目录。</p>
<p>可以通过简单地将其用作临时值来指定除 <code class="docutils literal notranslate"><span class="pre">$TMPDIR</span></code> 之外的自定义环境变量，例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scratch</span> <span class="s1">&#39;$MY_GRID_TMP&#39;</span>
</pre></div>
</div>
<p>注意，它必须用单引号字符包装，否则将在pipeline脚本上下文中评估变量。</p>
<p>您还可以将特定文件夹路径提供为临时值，例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scratch</span> <span class="s1">&#39;/tmp/my/path&#39;</span>
</pre></div>
</div>
<p>通过执行此操作，每次执行process时，将在指定的路径中创建新的临时目录。</p>
<p>最后，当 <code class="docutils literal notranslate"><span class="pre">ram-disk</span></code> 字符串作为 <code class="docutils literal notranslate"><span class="pre">scratch</span></code> 值提供时，该process将在节点RAM虚拟磁盘中执行。</p>
<p>Summary of allowed values:</p>
<table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="93%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">scratch</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>false</td>
<td>Do not use the scratch folder.</td>
</tr>
<tr class="row-odd"><td>true</td>
<td>Creates a scratch folder in the directory defined by the <code class="docutils literal notranslate"><span class="pre">$TMPDIR</span></code> variable; fallback to <code class="docutils literal notranslate"><span class="pre">mktemp</span> <span class="pre">/tmp</span></code> if that variable do not exists.</td>
</tr>
<tr class="row-even"><td>$YOUR_VAR</td>
<td>Creates a scratch folder in the directory defined by the <code class="docutils literal notranslate"><span class="pre">$YOUR_VAR</span></code> environment variable; fallback to <code class="docutils literal notranslate"><span class="pre">mktemp</span> <span class="pre">/tmp</span></code> if that variable do not exists.</td>
</tr>
<tr class="row-odd"><td>/my/tmp</td>
<td>Creates a scratch folder in the specified directory.</td>
</tr>
<tr class="row-even"><td>ram-disk</td>
<td>Creates a scratch folder in the RAM disk <code class="docutils literal notranslate"><span class="pre">/dev/shm/</span></code> (experimental).</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="storedir">
<span id="process-storedir"></span><h3>storeDir<a class="headerlink" href="#storedir" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">storeDir</span></code> 指令允许您定义用作process结果的永久缓存的目录。</p>
<p>更详细地说，它以两种主要方式影响process执行:</p>
<ol class="arabic simple">
<li>只有在 <code class="docutils literal notranslate"><span class="pre">storeDir</span></code>  指令指定的目录中不存在output子句中声明的文件时，才会执行该过程。 当文件存在时，将跳过流程执行，并将这些文件用作实际流程结果。</li>
<li>每当process成功完成时，输出声明块中列出的文件将被移动到 <code class="docutils literal notranslate"><span class="pre">storeDir</span></code> 指令指定的目录中.</li>
</ol>
<p>以下示例显示如何使用 <code class="docutils literal notranslate"><span class="pre">storeDir</span></code> 指令为输入参数指定的每个物种创建包含BLAST数据库的目录:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">genomes</span> <span class="o">=</span> <span class="n">Channel</span><span class="o">.</span><span class="n">fromPath</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">genomes</span><span class="p">)</span>

<span class="n">process</span> <span class="n">formatBlastDatabases</span> <span class="p">{</span>

  <span class="n">storeDir</span> <span class="s1">&#39;/db/genomes&#39;</span>

  <span class="nb">input</span><span class="p">:</span>
  <span class="n">file</span> <span class="n">species</span> <span class="kn">from</span> <span class="nn">genomes</span>

  <span class="n">output</span><span class="p">:</span>
  <span class="n">file</span> <span class="s2">&quot;$</span><span class="si">{dbName}</span><span class="s2">.*&quot;</span> <span class="n">into</span> <span class="n">blastDb</span>

  <span class="n">script</span><span class="p">:</span>
  <span class="n">dbName</span> <span class="o">=</span> <span class="n">species</span><span class="o">.</span><span class="n">baseName</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  makeblastdb -dbtype nucl -in ${species} -out ${dbName}</span>
<span class="sd">  &quot;&quot;&quot;</span>

<span class="p">}</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">storeDir</span></code> 指令用于长期process缓存，不应用于将process生成的文件输出到特定文件夹或组织语义目录结构中的结果数据。 在这些情况下，您可以使用 <a class="reference internal" href="#publishdir">publishDir</a> 指令。</p>
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">The use of AWS S3 path is supported however it requires the installation of the <a class="reference external" href="https://aws.amazon.com/cli/">AWS CLI tool</a>
(ie. <code class="docutils literal notranslate"><span class="pre">aws</span></code>) in the target computing node.</p>
</div>
</div>
<div class="section" id="stageinmode">
<span id="process-stageinmode"></span><h3>stageInMode<a class="headerlink" href="#stageinmode" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">stageInMode</span></code> 指令定义输入文件如何进入process工作目录。 允许以下值：</p>
<table border="1" class="docutils">
<colgroup>
<col width="5%" />
<col width="95%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>copy</td>
<td>Input files are staged in the process work directory by creating a copy.</td>
</tr>
<tr class="row-odd"><td>link</td>
<td>Input files are staged in the process work directory by creating an (hard) link for each of them.</td>
</tr>
<tr class="row-even"><td>symlink</td>
<td>Input files are staged in the process work directory by creating a symbolic link with an absolute path for each of them (default).</td>
</tr>
<tr class="row-odd"><td>rellink</td>
<td>Input files are staged in the process work directory by creating a symbolic link with a relative path for each of them.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="stageoutmode">
<span id="process-stageoutmode"></span><h3>stageOutMode<a class="headerlink" href="#stageoutmode" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">stageOutMode</span></code> 指令定义输出文件如何从暂存目录转移到process工作目录。 允许以下值：</p>
<table border="1" class="docutils">
<colgroup>
<col width="6%" />
<col width="94%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>copy</td>
<td>Output files are copied from the scratch directory to the work directory.</td>
</tr>
<tr class="row-odd"><td>move</td>
<td>Output files are moved from the scratch directory to the work directory.</td>
</tr>
<tr class="row-even"><td>rsync</td>
<td>Output files are copied from the scratch directory to the work directory by using the <code class="docutils literal notranslate"><span class="pre">rsync</span></code> utility.</td>
</tr>
</tbody>
</table>
<p>See also: <a class="reference internal" href="#scratch">scratch</a>.</p>
</div>
<div class="section" id="tag">
<span id="process-tag"></span><h3>tag<a class="headerlink" href="#tag" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">tag</span></code> 指令允许您将每个process执行与自定义标签相关联，以便在日志文件或跟踪执行报告中更容易识别它们。 例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">foo</span> <span class="p">{</span>
  <span class="n">tag</span> <span class="s2">&quot;$code&quot;</span>

  <span class="nb">input</span><span class="p">:</span>
  <span class="n">val</span> <span class="n">code</span> <span class="kn">from</span> <span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="s1">&#39;gamma&#39;</span><span class="p">,</span> <span class="s1">&#39;omega&#39;</span>

  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  echo $code</span>
<span class="sd">  &quot;&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>上面的代码段将打印一个类似于以下内容的日志，其中process名称包含标记值:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">6</span><span class="n">e</span><span class="o">/</span><span class="mi">28919</span><span class="n">b</span><span class="p">]</span> <span class="n">Submitted</span> <span class="n">process</span> <span class="o">&gt;</span> <span class="n">foo</span> <span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
<span class="p">[</span><span class="n">d2</span><span class="o">/</span><span class="mi">1</span><span class="n">c6175</span><span class="p">]</span> <span class="n">Submitted</span> <span class="n">process</span> <span class="o">&gt;</span> <span class="n">foo</span> <span class="p">(</span><span class="n">gamma</span><span class="p">)</span>
<span class="p">[</span><span class="mi">1</span><span class="n">c</span><span class="o">/</span><span class="mi">3</span><span class="n">ef220</span><span class="p">]</span> <span class="n">Submitted</span> <span class="n">process</span> <span class="o">&gt;</span> <span class="n">foo</span> <span class="p">(</span><span class="n">omega</span><span class="p">)</span>
</pre></div>
</div>
<p>See also <a class="reference internal" href="tracing.html#trace-report"><span class="std std-ref">Trace execution report</span></a></p>
</div>
<div class="section" id="time">
<span id="process-time"></span><h3>time<a class="headerlink" href="#time" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">time</span></code> 指令允许您定义允许process运行的时间。 例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">big_job</span> <span class="p">{</span>

    <span class="n">time</span> <span class="s1">&#39;1h&#39;</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    your task script here</span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>指定持续时间值时，可以使用以下时间单位后缀：</p>
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="65%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Unit</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>s</td>
<td>Seconds</td>
</tr>
<tr class="row-odd"><td>m</td>
<td>Minutes</td>
</tr>
<tr class="row-even"><td>h</td>
<td>Hours</td>
</tr>
<tr class="row-odd"><td>d</td>
<td>Days</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">This directive is taken in account only when using one of the following grid based executors:
<a class="reference internal" href="executor.html#sge-executor"><span class="std std-ref">SGE</span></a>, <a class="reference internal" href="executor.html#lsf-executor"><span class="std std-ref">LSF</span></a>, <a class="reference internal" href="executor.html#slurm-executor"><span class="std std-ref">SLURM</span></a>, <a class="reference internal" href="executor.html#pbs-executor"><span class="std std-ref">PBS/Torque</span></a>,
<a class="reference internal" href="executor.html#condor-executor"><span class="std std-ref">HTCondor</span></a> and <a class="reference internal" href="executor.html#awsbatch-executor"><span class="std std-ref">AWS Batch</span></a> executors.</p>
</div>
<p>See also: <a class="reference internal" href="#cpus">cpus</a>, <a class="reference internal" href="#memory">memory</a>, <a class="reference internal" href="#queue">queue</a> and <a class="reference internal" href="#dynamic-computing-resources">Dynamic computing resources</a>.</p>
</div>
<div class="section" id="validexitstatus">
<span id="process-validexitstatus"></span><h3>validExitStatus<a class="headerlink" href="#validexitstatus" title="永久链接至标题">¶</a></h3>
<p>当执行的命令返回错误退出状态时，process终止。 默认情况下，除 <code class="docutils literal notranslate"><span class="pre">0</span></code>  以外的任何错误状态都将被解释为错误条件。</p>
<p><code class="docutils literal notranslate"><span class="pre">validExitStatus</span></code> 指令允许您精确控制哪个错误状态将代表成功执行命令。 您可以指定单个值或多个值，如以下示例所示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">returnOk</span> <span class="p">{</span>
    <span class="n">validExitStatus</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span>

     <span class="n">script</span><span class="p">:</span>
     <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     echo Hello</span>
<span class="sd">     exit 1</span>
<span class="sd">     &quot;&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>在上面的示例中，尽管命令脚本以 <code class="docutils literal notranslate"><span class="pre">1</span></code> 退出状态结束，但该process不会返回错误条件，因为值 <code class="docutils literal notranslate"><span class="pre">1</span></code>  在 <code class="docutils literal notranslate"><span class="pre">validExitStatus</span></code> 指令中被声明为有效状态。</p>
</div>
<div class="section" id="dynamic-directives">
<h3>Dynamic directives<a class="headerlink" href="#dynamic-directives" title="永久链接至标题">¶</a></h3>
<p>可以在process执行期间动态分配指令，以便可以根据一个或多个process输入值来评估其实际值。</p>
<p>为了以动态方式定义，需要使用 <a class="reference internal" href="script.html#script-closure"><span class="std std-ref">closure</span></a> 语句表达指令的值，如下例所示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>process foo {

  executor &#39;sge&#39;
  queue { entries &gt; 100 ? &#39;long&#39; : &#39;short&#39; }

  input:
  set entries, file(x) from data

  script:
  &quot;&quot;&quot;
  &lt; your job here &gt;
  &quot;&quot;&quot;
}
</pre></div>
</div>
<p>在上面的示例中， <a class="reference internal" href="#queue">queue</a> 指令是动态计算的，具体取决于输入值 <code class="docutils literal notranslate"><span class="pre">entries</span></code> 。 当它大于100时，作业将被提交到 <code class="docutils literal notranslate"><span class="pre">long</span></code> 队列中，否则将使用 <code class="docutils literal notranslate"><span class="pre">short</span></code> 队列作业。</p>
<p>可以将所有指令分配给动态值，但以下情况除外：</p>
<ul class="simple">
<li><a class="reference internal" href="#executor">executor</a></li>
<li><a class="reference internal" href="#maxforks">maxForks</a></li>
</ul>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">您可以使用包含当前process实例中定义的指令值的隐式变量 <code class="docutils literal notranslate"><span class="pre">task</span></code> 来检索process脚本中动态指令的当前值。</p>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>process foo {

   queue { entries &gt; 100 ? &#39;long&#39; : &#39;short&#39; }

   input:
   set entries, file(x) from data

   script:
   &quot;&quot;&quot;
   echo Current queue: ${task.queue}
   &quot;&quot;&quot;
 }
</pre></div>
</div>
</div>
<div class="section" id="dynamic-computing-resources">
<h3>Dynamic computing resources<a class="headerlink" href="#dynamic-computing-resources" title="永久链接至标题">¶</a></h3>
<p>这是一种非常常见的情况，即同一process的不同实例在计算资源方面可能有非常不同的需求。 例如，在这种情况下请求一定量的内存太低会导致某些任务失败。 相反，使用适合执行中所有任务的更高限制可能会显着降低作业的执行优先级。</p>
<p><a class="reference internal" href="#dynamic-directives">Dynamic directives</a>  评估功能可用于修改在process失败的情况下请求的计算资源量，并尝试使用更高的限制重新执行它。 例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>process foo {

    memory { 2.GB * task.attempt }
    time { 1.hour * task.attempt }

    errorStrategy { task.exitStatus == 140 ? &#39;retry&#39; : &#39;terminate&#39; }
    maxRetries 3

    script:
    &lt;your job here&gt;

}
</pre></div>
</div>
<p>在上面的示例中，动态定义了 <a class="reference internal" href="#memory">memory</a> 和执行 <a class="reference internal" href="#time">time</a> 限制。 第一次执行该process时， <code class="docutils literal notranslate"><span class="pre">task.attempt</span></code> 设置为 <code class="docutils literal notranslate"><span class="pre">1</span></code>，因此它将请求2GB的内存和1小时的最长执行时间。</p>
<p>如果任务执行失败，报告退出状态等于 <code class="docutils literal notranslate"><span class="pre">140</span></code>，则重新提交任务（否则立即终止）。 这次 <code class="docutils literal notranslate"><span class="pre">task.attempt</span></code> 的值为 <code class="docutils literal notranslate"><span class="pre">2</span></code>，从而将内存量增加到4GB，时间增加到2小时，依此类推。</p>
<p>指令 <cite>maxRetries</cite> 设置可以重新执行同一任务的最大时间。</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="channel.html" class="btn btn-neutral float-right" title="Channels" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="script.html" class="btn btn-neutral float-left" title="Nextflow 脚本语言" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, lidanqing

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>