

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Amazon Cloud &mdash; Nextflow-ZH-documentation 0.0.1 文档</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="Amazon S3 storage" href="amazons3.html" />
    <link rel="prev" title="Configuration" href="config.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Nextflow-ZH-documentation
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getstarted.html">开始</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic.html">基本理念</a></li>
<li class="toctree-l1"><a class="reference internal" href="script.html">Nextflow 脚本语言</a></li>
<li class="toctree-l1"><a class="reference internal" href="process.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="channel.html">Channels</a></li>
<li class="toctree-l1"><a class="reference internal" href="operator.html">Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="executor.html">Executors</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html">Configuration</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Amazon Cloud</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#configuration">Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#aws-credentials">AWS credentials</a></li>
<li class="toctree-l3"><a class="reference internal" href="#user-ssh-key">User &amp; SSH key</a></li>
<li class="toctree-l3"><a class="reference internal" href="#storage">Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#boot-storage">Boot storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#instance-storage">Instance storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#shared-file-system">Shared file system</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cluster-deployment">Cluster deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pipeline-execution">Pipeline execution</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cluster-shutdown">Cluster shutdown</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cluster-auto-scaling">Cluster auto-scaling</a></li>
<li class="toctree-l2"><a class="reference internal" href="#spot-prices">Spot prices</a></li>
<li class="toctree-l2"><a class="reference internal" href="#advanced-configuration">Advanced configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#aws-batch">AWS Batch</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#awscloud-batch-config">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#custom-ami">Custom AMI</a></li>
<li class="toctree-l3"><a class="reference internal" href="#aws-cli-installation">AWS CLI installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#custom-job-definition">Custom job definition</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">Pipeline execution</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hybrid-workloads">Hybrid workloads</a></li>
<li class="toctree-l3"><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="amazons3.html">Amazon S3 storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="google.html">Google Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="conda.html">Conda environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker.html">Docker containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="singularity.html">Singularity containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="ignite.html">Apache Ignite</a></li>
<li class="toctree-l1"><a class="reference internal" href="kubernetes.html">Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="tracing.html">Tracing &amp; visualisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="sharing.html">Pipeline sharing</a></li>
<li class="toctree-l1"><a class="reference internal" href="metadata.html">Workflow introspection</a></li>
<li class="toctree-l1"><a class="reference internal" href="mail.html">Mail &amp; Notifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="example.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Nextflow-ZH-documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Amazon Cloud</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/doc/awscloud.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="amazon-cloud">
<span id="awscloud-page"></span><h1>Amazon Cloud<a class="headerlink" href="#amazon-cloud" title="永久链接至标题">¶</a></h1>
<p>Nextflow provides out of the box support for the Amazon AWS cloud allowing you to setup a computing cluster,
deploy it and run your pipeline in the AWS infrastructure in a few commands.</p>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="永久链接至标题">¶</a></h2>
<p>Cloud configuration attributes are provided in the <code class="docutils literal notranslate"><span class="pre">nextflow.config</span></code> file as shown in the example below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cloud</span> <span class="p">{</span>
    <span class="n">imageId</span> <span class="o">=</span> <span class="s1">&#39;ami-4b7daa32&#39;</span>
    <span class="n">instanceType</span> <span class="o">=</span> <span class="s1">&#39;m4.xlarge&#39;</span>
    <span class="n">subnetId</span> <span class="o">=</span> <span class="s1">&#39;subnet-05222a43&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The above attributes define the virtual machine ID and type to be used and the VPC subnet ID to be applied
in you cluster. Replace these values with the ones of your choice.</p>
<p>Nextflow only requires a Linux image that provides support for <a class="reference external" href="http://cloudinit.readthedocs.io/">Cloud-init</a>
bootstrapping mechanism and includes a Java runtime (version 8) and a Docker engine (version 1.11 or later).</p>
<p>For your convenience the following pre-configured Amazon Linux AMI is available in the <em>EU Ireland</em> region:
<code class="docutils literal notranslate"><span class="pre">ami-4b7daa32</span></code>.</p>
<div class="section" id="aws-credentials">
<h3>AWS credentials<a class="headerlink" href="#aws-credentials" title="永久链接至标题">¶</a></h3>
<p>Nextflow will use the AWS credentials defined in your environment, using the standard AWS variables shown below:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">AWS_ACCESS_KEY_ID</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">AWS_SECRET_ACCESS_KEY</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">AWS_DEFAULT_REGION</span></code></li>
</ul>
</div></blockquote>
<p>Alternatively AWS credentials can be specified in the Nextflow configuration file.
See <a class="reference internal" href="config.html#config-aws"><span class="std std-ref">AWS configuration</span></a> for more details.</p>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">Credentials can also be provided by using an IAM Instance Role. The benefit of this approach is that
it spares you from managing/distributing AWS keys explicitly.
Read the <a class="reference external" href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html">IAM Roles</a> documentation
and <a class="reference external" href="https://aws.amazon.com/blogs/security/granting-permission-to-launch-ec2-instances-with-iam-roles-passrole-permission/">this blog post</a> for more details.</p>
</div>
</div>
<div class="section" id="user-ssh-key">
<h3>User &amp; SSH key<a class="headerlink" href="#user-ssh-key" title="永久链接至标题">¶</a></h3>
<p>By default Nextflow creates in each EC2 instance a user with the same name as the one in your local computer and install
the SSH public key available at the path <code class="docutils literal notranslate"><span class="pre">$HOME/.ssh/id_rsa.pub</span></code>. A different user/key can be specified as shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cloud</span> <span class="p">{</span>
    <span class="n">userName</span> <span class="o">=</span> <span class="s1">&#39;the-user-name&#39;</span>
    <span class="n">keyFile</span> <span class="o">=</span> <span class="s1">&#39;/path/to/ssh/key.pub&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If you want to use a <em>key-pair</em> defined in your AWS account and the default user configured in the AMI, specify the
attribute <code class="docutils literal notranslate"><span class="pre">keyName</span></code> in place of <code class="docutils literal notranslate"><span class="pre">keyFile</span></code> and the name of the existing user specifying the <code class="docutils literal notranslate"><span class="pre">userName</span></code> attribute.</p>
</div>
<div class="section" id="storage">
<h3>Storage<a class="headerlink" href="#storage" title="永久链接至标题">¶</a></h3>
<p>The following storage types can be defined in the cloud instances: <em>boot</em>, <em>instance</em> and <em>shared</em>.</p>
</div>
<div class="section" id="boot-storage">
<h3>Boot storage<a class="headerlink" href="#boot-storage" title="永久链接至标题">¶</a></h3>
<p>You can set the size of the <a class="reference external" href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/RootDeviceStorage.html">root device volume</a>
by specifying the attribute <code class="docutils literal notranslate"><span class="pre">bootStorageSize</span></code>. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cloud</span> <span class="p">{</span>
    <span class="n">imageId</span> <span class="o">=</span> <span class="s1">&#39;ami-xxx&#39;</span>
    <span class="n">bootStorageSize</span> <span class="o">=</span> <span class="s1">&#39;10 GB&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="instance-storage">
<h3>Instance storage<a class="headerlink" href="#instance-storage" title="永久链接至标题">¶</a></h3>
<p>Amazon instances can provide one or more <a class="reference external" href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/InstanceStorage.html">ephemeral storage volumes</a>,
depending the instance type chosen. This storage can be made available by using the <code class="docutils literal notranslate"><span class="pre">instanceStorageMount</span></code>
configuration attributes, as shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cloud</span> <span class="p">{</span>
    <span class="n">imageId</span> <span class="o">=</span> <span class="s1">&#39;ami-xxx&#39;</span>
    <span class="n">instanceStorageMount</span> <span class="o">=</span> <span class="s1">&#39;/mnt/scratch&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The mount path can be any of your choice.</p>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">When the selected instance provides more than one ephemeral storage volume, Nextflow automatically groups all
of them together in a single logical volume and mounts it to the specified path. Therefore the resulting instance
storage size is equals to the sum of the sizes of all ephemeral volumes provided by the actual instance
(this feature requires Nextflow version 0.27.0 or later).</p>
</div>
<p>If you want to mount a specific instance storage volume, specify the corresponding device name by using
the <code class="docutils literal notranslate"><span class="pre">instanceStorageDevice</span></code> setting in the above configuration. See the Amazon documentation for details on
<a class="reference external" href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/InstanceStorage.html">EC2 Instance storage</a> and
<a class="reference external" href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/device_naming.html">devices naming</a>.</p>
</div>
<div class="section" id="shared-file-system">
<h3>Shared file system<a class="headerlink" href="#shared-file-system" title="永久链接至标题">¶</a></h3>
<p>A shared file system can easily be made available in your cloud cluster by using the <a class="reference external" href="https://aws.amazon.com/efs/">Amazon EFS</a>
storage. You will only need to specify in the cloud configuration the EFS file system ID and optionally the
mount path. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cloud</span> <span class="p">{</span>
    <span class="n">imageId</span> <span class="o">=</span> <span class="s1">&#39;ami-xxx&#39;</span>
    <span class="n">sharedStorageId</span> <span class="o">=</span> <span class="s1">&#39;fs-1803efd1&#39;</span>
    <span class="n">sharedStorageMount</span> <span class="o">=</span> <span class="s1">&#39;/mnt/shared&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">When the attribute <code class="docutils literal notranslate"><span class="pre">sharedStorageMount</span></code> is omitted the path <code class="docutils literal notranslate"><span class="pre">/mnf/efs</span></code> is used by default.</p>
</div>
</div>
</div>
<div class="section" id="cluster-deployment">
<h2>Cluster deployment<a class="headerlink" href="#cluster-deployment" title="永久链接至标题">¶</a></h2>
<p>Once defined the configuration settings in the <code class="docutils literal notranslate"><span class="pre">nextflow.config</span></code> file you can create the cloud cluster
by using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nextflow</span> <span class="n">cloud</span> <span class="n">create</span> <span class="n">my</span><span class="o">-</span><span class="n">cluster</span> <span class="o">-</span><span class="n">c</span> <span class="o">&lt;</span><span class="n">num</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">nodes</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The string <code class="docutils literal notranslate"><span class="pre">my-cluster</span></code> identifies the cluster instance. Replace it with a name of your choice.</p>
<p>Finally replace <code class="docutils literal notranslate"><span class="pre">num-of-nodes</span></code> with the actual number of instances that will made-up the cluster.
One node is created as <em>master</em>, the remaining as <em>workers</em>. If the option <code class="docutils literal notranslate"><span class="pre">-c</span></code> is omitted only the <em>master</em> node
is created.</p>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last">You will be charged accordingly the type and the number of instances chosen.</p>
</div>
</div>
<div class="section" id="pipeline-execution">
<h2>Pipeline execution<a class="headerlink" href="#pipeline-execution" title="永久链接至标题">¶</a></h2>
<p>Once the cluster initialization is complete, connect to the <em>master</em> node using the SSH command which will be displayed by
Nextflow.</p>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p>On MacOS, use the following command to avoid being asked for a pass-phrase even
you haven’t defined one:</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span><span class="o">-</span><span class="n">add</span> <span class="o">-</span><span class="n">K</span> <span class="p">[</span><span class="n">private</span> <span class="n">key</span> <span class="n">file</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>You can run your Nextflow pipeline as usual, the environment is automatically configured to use the <a class="reference internal" href="ignite.html#ignite-page"><span class="std std-ref">Ignite</span></a>
executor. If the Amazon EFS storage is specified in the cloud configuration the Nextflow work directory will
automatically be set in a shared folder in that file system.</p>
<p>The suggested approach is to run your pipeline downloading it from a public repository such
GitHub and to pack the binaries dependencies in a Docker container as described in the
<a class="reference internal" href="sharing.html#sharing-page"><span class="std std-ref">Pipeline sharing</span></a> section.</p>
</div>
<div class="section" id="cluster-shutdown">
<h2>Cluster shutdown<a class="headerlink" href="#cluster-shutdown" title="永久链接至标题">¶</a></h2>
<p>When completed shutdown the cluster instances by using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nextflow</span> <span class="n">cloud</span> <span class="n">shutdown</span> <span class="n">my</span><span class="o">-</span><span class="n">cluster</span>
</pre></div>
</div>
</div>
<div class="section" id="cluster-auto-scaling">
<h2>Cluster auto-scaling<a class="headerlink" href="#cluster-auto-scaling" title="永久链接至标题">¶</a></h2>
<p>Nextflow integration for AWS cloud provides a native support auto-scaling that allows the computing cluster
to scale-out or scale-down i.e. add or remove computing nodes dynamically at runtime.</p>
<p>This is a critical feature, especially for pipelines crunching not homogeneous dataset, because it allows the
cluster to adapt dynamically to the actual workload computing resources need as they change over the time.</p>
<p>Cluster auto-scaling is enabled by adding the <code class="docutils literal notranslate"><span class="pre">autoscale</span></code> option group in the configuration file as shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cloud</span> <span class="p">{</span>
    <span class="n">imageId</span> <span class="o">=</span> <span class="s1">&#39;ami-xxx&#39;</span>
    <span class="n">autoscale</span> <span class="p">{</span>
        <span class="n">enabled</span> <span class="o">=</span> <span class="n">true</span>
        <span class="n">maxInstances</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The above example enables automatic cluster scale-out i.e. new instances are automatically launched and added to the
cluster when tasks remain too long in wait status because there aren’t enough computing resources available. The
<code class="docutils literal notranslate"><span class="pre">maxInstances</span></code> attribute defines the upper limit to which the cluster can grow.</p>
<p>By default unused instances are not removed when are not utilised. If you want to enable automatic cluster scale-down
specify the <code class="docutils literal notranslate"><span class="pre">terminateWhenIdle</span></code> attribute in the <code class="docutils literal notranslate"><span class="pre">autoscale</span></code> configuration group.</p>
<p>It is also possible to define a different AMI image ID, type and spot price for instances launched by the Nextflow autoscaler.
For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cloud</span> <span class="p">{</span>
    <span class="n">imageId</span> <span class="o">=</span> <span class="s1">&#39;ami-xxx&#39;</span>
    <span class="n">instanceType</span> <span class="o">=</span> <span class="s1">&#39;m4.large&#39;</span>

    <span class="n">autoscale</span> <span class="p">{</span>
        <span class="n">enabled</span> <span class="o">=</span> <span class="n">true</span>
        <span class="n">spotPrice</span> <span class="o">=</span> <span class="mf">0.15</span>
        <span class="n">minInstances</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">maxInstances</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">imageId</span> <span class="o">=</span> <span class="s1">&#39;ami-yyy&#39;</span>
        <span class="n">instanceType</span> <span class="o">=</span> <span class="s1">&#39;m4.4xlarge&#39;</span>
        <span class="n">terminateWhenIdle</span> <span class="o">=</span> <span class="n">true</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>By doing that it’s is possible to create a cluster with a single node i.e. the master node. Then the autoscaler will
automatically add the missing instances, up to the number defined by the <code class="docutils literal notranslate"><span class="pre">minInstances</span></code> attributes. These will have a
different image and type from the master node and will be launched a <em>spot instances</em> because the <code class="docutils literal notranslate"><span class="pre">spotPrice</span></code>
attribute has been specified.</p>
</div>
<div class="section" id="spot-prices">
<h2>Spot prices<a class="headerlink" href="#spot-prices" title="永久链接至标题">¶</a></h2>
<p>Nextflow includes an handy command to list the current price of EC2 spot instances. Simply type the following
command in your shell terminal:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nextflow</span> <span class="n">cloud</span> <span class="n">spot</span><span class="o">-</span><span class="n">prices</span>
</pre></div>
</div>
<p>It will print the current spot price for all available instances type, similar to the example below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TYPE</span>        <span class="n">PRICE</span>  <span class="n">PRICE</span><span class="o">/</span><span class="n">CPU</span> <span class="n">ZONE</span>       <span class="n">DESCRIPTION</span>             <span class="n">CPUS</span>   <span class="n">MEMORY</span> <span class="n">DISK</span>
<span class="n">t1</span><span class="o">.</span><span class="n">micro</span>    <span class="mf">0.0044</span>    <span class="mf">0.0044</span> <span class="n">eu</span><span class="o">-</span><span class="n">west</span><span class="o">-</span><span class="mi">1</span><span class="n">c</span> <span class="n">Linux</span><span class="o">/</span><span class="n">UNIX</span>                 <span class="mi">1</span> <span class="mf">627.7</span> <span class="n">MB</span> <span class="o">-</span>
<span class="n">m4</span><span class="o">.</span><span class="mi">4</span><span class="n">xlarge</span>  <span class="mf">0.1153</span>    <span class="mf">0.0072</span> <span class="n">eu</span><span class="o">-</span><span class="n">west</span><span class="o">-</span><span class="mi">1</span><span class="n">a</span> <span class="n">Linux</span><span class="o">/</span><span class="n">UNIX</span> <span class="p">(</span><span class="n">Amazon</span> <span class="n">VPC</span><span class="p">)</span>   <span class="mi">16</span>    <span class="mi">64</span> <span class="n">GB</span> <span class="o">-</span>
<span class="n">m4</span><span class="o">.</span><span class="mi">10</span><span class="n">xlarge</span> <span class="mf">0.2952</span>    <span class="mf">0.0074</span> <span class="n">eu</span><span class="o">-</span><span class="n">west</span><span class="o">-</span><span class="mi">1</span><span class="n">b</span> <span class="n">Linux</span><span class="o">/</span><span class="n">UNIX</span> <span class="p">(</span><span class="n">Amazon</span> <span class="n">VPC</span><span class="p">)</span>   <span class="mi">40</span>   <span class="mi">160</span> <span class="n">GB</span> <span class="o">-</span>
<span class="n">m4</span><span class="o">.</span><span class="n">large</span>    <span class="mf">0.0155</span>    <span class="mf">0.0077</span> <span class="n">eu</span><span class="o">-</span><span class="n">west</span><span class="o">-</span><span class="mi">1</span><span class="n">b</span> <span class="n">Linux</span><span class="o">/</span><span class="n">UNIX</span> <span class="p">(</span><span class="n">Amazon</span> <span class="n">VPC</span><span class="p">)</span>    <span class="mi">2</span>     <span class="mi">8</span> <span class="n">GB</span> <span class="o">-</span>
<span class="n">m4</span><span class="o">.</span><span class="mi">2</span><span class="n">xlarge</span>  <span class="mf">0.0612</span>    <span class="mf">0.0077</span> <span class="n">eu</span><span class="o">-</span><span class="n">west</span><span class="o">-</span><span class="mi">1</span><span class="n">a</span> <span class="n">Linux</span><span class="o">/</span><span class="n">UNIX</span> <span class="p">(</span><span class="n">Amazon</span> <span class="n">VPC</span><span class="p">)</span>    <span class="mi">8</span>    <span class="mi">32</span> <span class="n">GB</span> <span class="o">-</span>
<span class="n">m4</span><span class="o">.</span><span class="n">xlarge</span>   <span class="mf">0.0312</span>    <span class="mf">0.0078</span> <span class="n">eu</span><span class="o">-</span><span class="n">west</span><span class="o">-</span><span class="mi">1</span><span class="n">a</span> <span class="n">Linux</span><span class="o">/</span><span class="n">UNIX</span> <span class="p">(</span><span class="n">Amazon</span> <span class="n">VPC</span><span class="p">)</span>    <span class="mi">4</span>    <span class="mi">16</span> <span class="n">GB</span> <span class="o">-</span>
<span class="n">c4</span><span class="o">.</span><span class="mi">8</span><span class="n">xlarge</span>  <span class="mf">0.3406</span>    <span class="mf">0.0095</span> <span class="n">eu</span><span class="o">-</span><span class="n">west</span><span class="o">-</span><span class="mi">1</span><span class="n">c</span> <span class="n">Linux</span><span class="o">/</span><span class="n">UNIX</span> <span class="p">(</span><span class="n">Amazon</span> <span class="n">VPC</span><span class="p">)</span>   <span class="mi">36</span>    <span class="mi">60</span> <span class="n">GB</span> <span class="o">-</span>
<span class="n">m1</span><span class="o">.</span><span class="n">xlarge</span>   <span class="mf">0.0402</span>    <span class="mf">0.0100</span> <span class="n">eu</span><span class="o">-</span><span class="n">west</span><span class="o">-</span><span class="mi">1</span><span class="n">b</span> <span class="n">Linux</span><span class="o">/</span><span class="n">UNIX</span>                 <span class="mi">4</span>    <span class="mi">15</span> <span class="n">GB</span> <span class="mi">4</span> <span class="n">x</span> <span class="mi">420</span> <span class="n">GB</span>
<span class="n">c4</span><span class="o">.</span><span class="mi">4</span><span class="n">xlarge</span>  <span class="mf">0.1652</span>    <span class="mf">0.0103</span> <span class="n">eu</span><span class="o">-</span><span class="n">west</span><span class="o">-</span><span class="mi">1</span><span class="n">b</span> <span class="n">Linux</span><span class="o">/</span><span class="n">UNIX</span> <span class="p">(</span><span class="n">Amazon</span> <span class="n">VPC</span><span class="p">)</span>   <span class="mi">16</span>    <span class="mi">30</span> <span class="n">GB</span> <span class="o">-</span>
<span class="n">c1</span><span class="o">.</span><span class="n">xlarge</span>   <span class="mf">0.0825</span>    <span class="mf">0.0103</span> <span class="n">eu</span><span class="o">-</span><span class="n">west</span><span class="o">-</span><span class="mi">1</span><span class="n">a</span> <span class="n">Linux</span><span class="o">/</span><span class="n">UNIX</span>                 <span class="mi">8</span>     <span class="mi">7</span> <span class="n">GB</span> <span class="mi">4</span> <span class="n">x</span> <span class="mi">420</span> <span class="n">GB</span>
<span class="n">m1</span><span class="o">.</span><span class="n">medium</span>   <span class="mf">0.0104</span>    <span class="mf">0.0104</span> <span class="n">eu</span><span class="o">-</span><span class="n">west</span><span class="o">-</span><span class="mi">1</span><span class="n">b</span> <span class="n">Linux</span><span class="o">/</span><span class="n">UNIX</span> <span class="p">(</span><span class="n">Amazon</span> <span class="n">VPC</span><span class="p">)</span>    <span class="mi">1</span>   <span class="mf">3.8</span> <span class="n">GB</span> <span class="mi">1</span> <span class="n">x</span> <span class="mi">410</span> <span class="n">GB</span>
<span class="n">c3</span><span class="o">.</span><span class="mi">8</span><span class="n">xlarge</span>  <span class="mf">0.3370</span>    <span class="mf">0.0105</span> <span class="n">eu</span><span class="o">-</span><span class="n">west</span><span class="o">-</span><span class="mi">1</span><span class="n">a</span> <span class="n">Linux</span><span class="o">/</span><span class="n">UNIX</span>                <span class="mi">32</span>    <span class="mi">60</span> <span class="n">GB</span> <span class="mi">2</span> <span class="n">x</span> <span class="mi">320</span> <span class="n">GB</span>
<span class="n">c3</span><span class="o">.</span><span class="mi">2</span><span class="n">xlarge</span>  <span class="mf">0.0860</span>    <span class="mf">0.0108</span> <span class="n">eu</span><span class="o">-</span><span class="n">west</span><span class="o">-</span><span class="mi">1</span><span class="n">c</span> <span class="n">Linux</span><span class="o">/</span><span class="n">UNIX</span>                 <span class="mi">8</span>    <span class="mi">15</span> <span class="n">GB</span> <span class="mi">2</span> <span class="n">x</span> <span class="mi">80</span> <span class="n">GB</span>
<span class="n">c3</span><span class="o">.</span><span class="mi">4</span><span class="n">xlarge</span>  <span class="mf">0.1751</span>    <span class="mf">0.0109</span> <span class="n">eu</span><span class="o">-</span><span class="n">west</span><span class="o">-</span><span class="mi">1</span><span class="n">c</span> <span class="n">Linux</span><span class="o">/</span><span class="n">UNIX</span> <span class="p">(</span><span class="n">Amazon</span> <span class="n">VPC</span><span class="p">)</span>   <span class="mi">16</span>    <span class="mi">30</span> <span class="n">GB</span> <span class="mi">2</span> <span class="n">x</span> <span class="mi">160</span> <span class="n">GB</span>
<span class="n">m3</span><span class="o">.</span><span class="mi">2</span><span class="n">xlarge</span>  <span class="mf">0.0869</span>    <span class="mf">0.0109</span> <span class="n">eu</span><span class="o">-</span><span class="n">west</span><span class="o">-</span><span class="mi">1</span><span class="n">c</span> <span class="n">Linux</span><span class="o">/</span><span class="n">UNIX</span> <span class="p">(</span><span class="n">Amazon</span> <span class="n">VPC</span><span class="p">)</span>    <span class="mi">8</span>    <span class="mi">30</span> <span class="n">GB</span> <span class="mi">2</span> <span class="n">x</span> <span class="mi">80</span> <span class="n">GB</span>
<span class="n">r3</span><span class="o">.</span><span class="n">large</span>    <span class="mf">0.0218</span>    <span class="mf">0.0109</span> <span class="n">eu</span><span class="o">-</span><span class="n">west</span><span class="o">-</span><span class="mi">1</span><span class="n">c</span> <span class="n">Linux</span><span class="o">/</span><span class="n">UNIX</span>                 <span class="mi">2</span>  <span class="mf">15.2</span> <span class="n">GB</span> <span class="mi">1</span> <span class="n">x</span> <span class="mi">32</span> <span class="n">GB</span>
<span class="p">:</span>
</pre></div>
</div>
<p>It’s even possible to refine the showed data by specifying a filtering and ordering criteria. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nextflow</span> <span class="n">cloud</span> <span class="n">spot</span><span class="o">-</span><span class="n">prices</span> <span class="o">-</span><span class="n">sort</span> <span class="n">pricecpu</span> <span class="o">-</span><span class="nb">filter</span> <span class="s2">&quot;cpus==4&quot;</span>
</pre></div>
</div>
<p>It will only print instance types having 4 cpus and sorting them by the best price per cpu.</p>
</div>
<div class="section" id="advanced-configuration">
<h2>Advanced configuration<a class="headerlink" href="#advanced-configuration" title="永久链接至标题">¶</a></h2>
<p>Read <a class="reference internal" href="config.html#config-cloud"><span class="std std-ref">Cloud configuration</span></a> section to learn more about advanced cloud configuration options.</p>
</div>
<div class="section" id="aws-batch">
<span id="awscloud-batch"></span><h2>AWS Batch<a class="headerlink" href="#aws-batch" title="永久链接至标题">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last">Requires Nextflow version <cite>0.26.0</cite> or later.</p>
</div>
<p><a class="reference external" href="https://aws.amazon.com/batch/">AWS Batch</a> is a managed computing service that allows the execution of containerised
workloads in the Amazon cloud infrastructure.</p>
<p>Nextflow provides a built-in support for AWS Batch which allows the seamless deployment of a Nextflow pipeline
in the cloud offloading the process executions as Batch jobs.</p>
<div class="section" id="awscloud-batch-config">
<span id="id2"></span><h3>Configuration<a class="headerlink" href="#awscloud-batch-config" title="永久链接至标题">¶</a></h3>
<p>1 - Make sure your pipeline processes specifies one or more Docker containers by using the <a class="reference internal" href="process.html#process-container"><span class="std std-ref">container</span></a> directive.</p>
<p>2 - Container images need to be published in a Docker registry such as <a class="reference external" href="https://hub.docker.com/">Docker Hub</a>,
<a class="reference external" href="https://quay.io/">Quay</a> or <a class="reference external" href="https://aws.amazon.com/ecr/">ECS Container Registry</a> that can be reached
by ECS Batch.</p>
<p>3 - Specify the AWS Batch <a class="reference internal" href="executor.html#awsbatch-executor"><span class="std std-ref">executor</span></a> in the pipeline configuration.</p>
<p>4 - Specify one or more AWS Batch queues for the execution of your pipeline by using the <a class="reference internal" href="process.html#process-queue"><span class="std std-ref">queue</span></a> directive.
Batch queues allow you to bind the execution of a process to a specific computing environment ie. number of CPUs,
type of instances (On-demand or Spot), scaling ability, etc. See the <a class="reference external" href="http://docs.aws.amazon.com/batch/latest/userguide/create-job-queue.html">AWS Batch documentation</a> to learn
how to setup Batch queues.</p>
<p>5 - Make sure the container image includes the <a class="reference external" href="https://aws.amazon.com/cli">AWS CLI tool</a> i.e. <code class="docutils literal notranslate"><span class="pre">aws</span></code>.
Alternatively, it can also be installed in a custom AMI image. See the note below for details.</p>
<p>An example <code class="docutils literal notranslate"><span class="pre">nextflow.config</span></code> file is shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span><span class="o">.</span><span class="n">executor</span> <span class="o">=</span> <span class="s1">&#39;awsbatch&#39;</span>
<span class="n">process</span><span class="o">.</span><span class="n">queue</span> <span class="o">=</span> <span class="s1">&#39;my-batch-queue&#39;</span>
<span class="n">process</span><span class="o">.</span><span class="n">container</span> <span class="o">=</span> <span class="s1">&#39;quay.io/biocontainers/salmon&#39;</span>
<span class="n">aws</span><span class="o">.</span><span class="n">region</span> <span class="o">=</span> <span class="s1">&#39;eu-west-1&#39;</span>

<span class="o">//</span> <span class="n">NOTE</span><span class="p">:</span> <span class="n">this</span> <span class="n">setting</span> <span class="ow">is</span> <span class="n">only</span> <span class="n">required</span> <span class="k">if</span> <span class="n">the</span> <span class="n">AWS</span> <span class="n">CLI</span> <span class="n">tool</span> <span class="ow">is</span> <span class="n">installed</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">custom</span> <span class="n">AMI</span>
<span class="n">executor</span><span class="o">.</span><span class="n">awscli</span> <span class="o">=</span> <span class="s1">&#39;/home/ec2-user/miniconda/bin/aws&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">Nextflow requires to access the AWS command line tool (<code class="docutils literal notranslate"><span class="pre">aws</span></code>) from the container in which the job runs
in order to stage the required input files and to copy back the resulting output files in the
<a class="reference external" href="https://aws.amazon.com/s3/">S3 storage</a>.</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">aws</span></code> tool can either be included in container image(s) used by your pipeline execution or
installed in a custom AMI that needs to used in place of the default AMI when configuring the Batch
<a class="reference external" href="http://docs.aws.amazon.com/batch/latest/userguide/compute_environments.html">Computing environment</a>.</p>
<p>The latter approach is preferred  because it allows the use of existing Docker images without the need to add
the AWS CLI tool to them. See the sections below to learn how create a custom AMI and install the AWS CLI tool
to it.</p>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last">AWS Batch uses the default ECS instance AMI, which has only a 22 GB storage volume which may not
be enough for real world data analysis pipelines.</p>
</div>
<p>See the section below to learn how to create a custom AWS Batch custom AMI with a larger storage.</p>
</div>
<div class="section" id="custom-ami">
<h3>Custom AMI<a class="headerlink" href="#custom-ami" title="永久链接至标题">¶</a></h3>
<p>In the EC2 Dashboard, click the <cite>Launch Instance</cite> button, then choose <cite>AWS Marketplace</cite> in the left pane and enter
<cite>ECS</cite> in the search box. In result list select <cite>Amazon ECS-Optimized Amazon Linux AMI</cite>, then continue as usual to
configure and launch the instance.</p>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">The selected instance has a bootstrap volume of 8GB and a second EBS volume 22G for computation which is
hardly enough for real world genomic workloads. Make sure to specify an amount of storage in the second volume
large enough for the needs of your pipeline execution.</p>
</div>
<p>When the instance is running, SSH into it, install the AWS CLI tools as explained below or any other required tool
that may be required.</p>
<p>Also make sure the Docker configuration reflects the amount of storage you have specified when launching the instance
as shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ docker info | grep -i data
 Data file:
 Metadata file:
 Data Space Used: 500.2 MB
 Data Space Total: 1.061 TB
 Data Space Available: 1.06 TB
 Metadata Space Used: 733.2 kB
 Metadata Space Total: 1.074 GB
 Metadata Space Available: 1.073 GB
</pre></div>
</div>
<p>The above example shows the Docker data configuration for a 1000GB EBS data volume. See the <a class="reference external" href="http://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs-ami-storage-config.html">ECS Storage documentation</a>
for more details.</p>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last">The maximum storage size of a single Docker container is by default 10GB, independently the amount of data space available
in the underlying volume (see <a class="reference external" href="https://docs.docker.com/engine/reference/commandline/dockerd/#dmbasesize">Base device size</a> for more details).</p>
</div>
<p>You can verify the current setting by using this command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ docker info | grep -i base
  Base Device Size: 10.74 GB
</pre></div>
</div>
<p>If your pipeline needs more storage for a single task execution, you will need to specify the <code class="docutils literal notranslate"><span class="pre">dm.basesize</span></code> setting
with a proper value in the <code class="docutils literal notranslate"><span class="pre">/etc/sysconfig/docker-storage</span></code> configuration file.
See <a class="reference external" href="https://forums.aws.amazon.com/message.jspa?messageID=811761#811761">here</a>
and <a class="reference external" href="https://www.projectatomic.io/blog/2016/03/daemon_option_basedevicesize/">here</a> for details.</p>
<p>Once done that, create a new AMI by using the <em>Create Image</em> option in the EC2 Dashboard or the AWS command line tool.</p>
<p>The new AMI ID needs to be specified when creating the Batch
<a class="reference external" href="http://docs.aws.amazon.com/batch/latest/userguide/compute_environments.html">Computing environment</a>.</p>
</div>
<div class="section" id="aws-cli-installation">
<span id="aws-cli"></span><h3>AWS CLI installation<a class="headerlink" href="#aws-cli-installation" title="永久链接至标题">¶</a></h3>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last">The <a class="reference external" href="https://aws.amazon.com/cli">AWS CLI tool</a> must to be installed in your custom AMI
by using a self-contained package manager such as <a class="reference external" href="https://conda.io">Conda</a>.</p>
</div>
<p>The reason is that when the AWS CLI tool executes using Conda it will use the version of python supplied by Conda.
If you don’t use Conda and install the AWS CLI using something like <a class="reference external" href="https://pypi.org/project/pip/">pip</a> the <code class="docutils literal notranslate"><span class="pre">aws</span></code>
command will attempt to run using the version of python found in the running container which won’t be able to find
the necessary dependencies.</p>
<p>The following snippet shows how to install AWS CLI with <a class="reference external" href="https://conda.io/miniconda.html">Miniconda</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sudo yum install -y bzip2 wget
wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh
bash Miniconda3-latest-Linux-x86_64.sh -b -f -p $HOME/miniconda
$HOME/miniconda/bin/conda install -c conda-forge -y awscli
rm Miniconda3-latest-Linux-x86_64.sh
</pre></div>
</div>
<p>When complete verifies that the AWS CLI package works correctly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./miniconda/bin/aws --version
aws-cli/1.11.120 Python/3.6.3 Linux/4.9.43-17.39.amzn1.x86_64 botocore/1.5.83
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">The <code class="docutils literal notranslate"><span class="pre">aws</span></code> tool will be placed in a directory named <code class="docutils literal notranslate"><span class="pre">bin</span></code> in the main installation folder.
Modifying this directory structure, after the installation, will cause the tool to not work properly.</p>
</div>
<p>By default Nextflow will assume the AWS CLI tool is directly available in the container. To use an installation
from the host image specify the <code class="docutils literal notranslate"><span class="pre">awscli</span></code> parameter in the Nextflow <a class="reference internal" href="executor.html#awsbatch-executor"><span class="std std-ref">executor</span></a>
configuration as shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">executor</span><span class="o">.</span><span class="n">awscli</span> <span class="o">=</span> <span class="s1">&#39;/home/ec2-user/miniconda/bin/aws&#39;</span>
</pre></div>
</div>
<p>Replace the path above with the one matching the location where <code class="docutils literal notranslate"><span class="pre">aws</span></code> tool is installed in your AMI.</p>
</div>
<div class="section" id="custom-job-definition">
<h3>Custom job definition<a class="headerlink" href="#custom-job-definition" title="永久链接至标题">¶</a></h3>
<p>Nextflow automatically creates the Batch <a class="reference external" href="http://docs.aws.amazon.com/batch/latest/userguide/job_definitions.html">Job definitions</a>
needed to execute your pipeline processes. Therefore it’s not required to define them before run your workflow.</p>
<p>However you may still need to specify a custom <cite>Job Definition</cite> to fine control the configuration settings
of a specific job e.g. to define custom mount paths or other Batch Job special settings.</p>
<p>To do that first create a <em>Job Definition</em> in the AWS Console (or with other means). Note the name of the <em>Job Definition</em>
you created. You can then associate a process execution with this <em>Job definition</em> by using the <a class="reference internal" href="process.html#process-container"><span class="std std-ref">container</span></a>
directive and specifing, in place of the container image name, the Job definition name prefixed by the
<code class="docutils literal notranslate"><span class="pre">job-definition://</span></code> string, as shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span><span class="o">.</span><span class="n">container</span> <span class="o">=</span> <span class="s1">&#39;job-definition://your-job-definition-name&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h3>Pipeline execution<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h3>
<p>The pipeline can be launched either in a local computer or a EC2 instance. The latter is suggested for heavy or long
running workloads.</p>
<p>Pipeline input data can be stored to be stored either locally or in a <a class="reference external" href="https://aws.amazon.com/s3/">S3</a> bucket.
The pipeline execution must specifies a Google Storage bucket where jobs intermediate results are stored with the
<code class="docutils literal notranslate"><span class="pre">-bucket-dir</span></code> command line options. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nextflow</span> <span class="n">run</span> <span class="n">my</span><span class="o">-</span><span class="n">pipeline</span> <span class="o">-</span><span class="n">bucket</span><span class="o">-</span><span class="nb">dir</span> <span class="n">s3</span><span class="p">:</span><span class="o">//</span><span class="n">my</span><span class="o">-</span><span class="n">bucket</span><span class="o">/</span><span class="n">some</span><span class="o">/</span><span class="n">path</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last">The bucket path should include at least a top level directory name e.g. use <code class="docutils literal notranslate"><span class="pre">s3://my-bucket/work</span></code>
not just <code class="docutils literal notranslate"><span class="pre">s3://my-bucket</span></code>.</p>
</div>
</div>
<div class="section" id="hybrid-workloads">
<h3>Hybrid workloads<a class="headerlink" href="#hybrid-workloads" title="永久链接至标题">¶</a></h3>
<p>Nextflow allows the use of multiple executors in the same workflow application. This feature enables the deployment
of hybrid workloads in which some jobs are execute in the local computer or local computing cluster and
some jobs are offloaded to AWS Batch service.</p>
<p>To enable this feature use one or more <a class="reference internal" href="config.html#config-process-selectors"><span class="std std-ref">Process selectors</span></a> in your Nextflow configuration file to apply
the AWS Batch <a class="reference internal" href="#awscloud-batch-config"><span class="std std-ref">configuration</span></a> only to a subset of processes in your workflow.
For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">aws</span> <span class="p">{</span>
    <span class="n">region</span> <span class="o">=</span> <span class="s1">&#39;eu-west-1&#39;</span>
<span class="p">}</span>
<span class="n">executor</span> <span class="p">{</span>
  <span class="n">awscli</span> <span class="o">=</span> <span class="s1">&#39;/home/ec2-user/miniconda/bin/aws&#39;</span>
<span class="p">}</span>

<span class="n">process</span> <span class="p">{</span>
    <span class="n">withLabel</span><span class="p">:</span> <span class="n">bigTask</span> <span class="p">{</span>
      <span class="n">executor</span> <span class="o">=</span> <span class="s1">&#39;awsbatch&#39;</span>
      <span class="n">queue</span> <span class="o">=</span> <span class="s1">&#39;my-batch-queue&#39;</span>
      <span class="n">container</span> <span class="o">=</span> <span class="s1">&#39;my/image:tag&#39;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The above configuration snippet will deploy the execution with AWS Batch only for processes annotated
with the <a class="reference internal" href="process.html#process-label"><span class="std std-ref">label</span></a> <code class="docutils literal notranslate"><span class="pre">bigTask</span></code>, the remaining process with run in the local computer.</p>
</div>
<div class="section" id="troubleshooting">
<h3>Troubleshooting<a class="headerlink" href="#troubleshooting" title="永久链接至标题">¶</a></h3>
<p><strong>Problem</strong>: The Pipeline execution terminates with an AWS error message similar to the one shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">JobQueue</span> <span class="o">&lt;</span><span class="n">your</span> <span class="n">queue</span><span class="o">&gt;</span> <span class="ow">not</span> <span class="n">found</span>
</pre></div>
</div>
<p>Make sure you have defined a AWS region in the Nextflow configuration file and it matches the region
in which your Batch environment has been created.</p>
<p><strong>Problem</strong>: A process execution fails reporting the following error message:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Process</span> <span class="o">&lt;</span><span class="n">your</span> <span class="n">task</span><span class="o">&gt;</span> <span class="n">terminated</span> <span class="k">for</span> <span class="n">an</span> <span class="n">unknown</span> <span class="n">reason</span> <span class="o">--</span> <span class="n">Likely</span> <span class="n">it</span> <span class="n">has</span> <span class="n">been</span> <span class="n">terminated</span> <span class="n">by</span> <span class="n">the</span> <span class="n">external</span> <span class="n">system</span>
</pre></div>
</div>
<p>This may happen when Batch is unable to execute the process script. A common cause of this problem is that the
Docker container image you have specified uses a non standard <a class="reference external" href="https://docs.docker.com/engine/reference/builder/#entrypoint">entrypoint</a>
which does not allow the execution of the Bash launcher script required by Nextflow to run the job.</p>
<p>This may also happen if the AWS CLI doesn’t run correctly.</p>
<p>Other places to check for error information:</p>
<ul class="simple">
<li>The <code class="docutils literal notranslate"><span class="pre">.nextflow.log</span></code> file.</li>
<li>The Job execution log in the AWS Batch dashboard.</li>
<li>The <a class="reference external" href="https://aws.amazon.com/cloudwatch/">CloudWatch</a> logs found in the <code class="docutils literal notranslate"><span class="pre">/aws/batch/job</span></code> log group.</li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="amazons3.html" class="btn btn-neutral float-right" title="Amazon S3 storage" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="config.html" class="btn btn-neutral float-left" title="Configuration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, lidanqing

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>